<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="assets/docs-v=1599487820.css">
		<link rel="stylesheet" type="text/css" href="assets/theme-v=1599487820.css">
		<link rel="search" type="application/opensearchdescription+xml" title="Scheduler Docs" href="https://docs.dhtmlx.com/scheduler/assets/opensearch.xml">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="initial-scale = 1.0" />
		<meta name="description" content="" />
		<link href="assets/favicon.ico" rel="shortcut icon" />
		<!--[if lte IE 9]>
			<link rel="stylesheet" type="text/css" href="assets/ie.css" />
		<![endif]-->
		<!-- stub -->
		<title>dhtmlxScheduler with ASP.NET Core  Scheduler Docs</title>
	</head>
<body class="page_">
	<!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5M5RCSJ');</script><!-- End Google Tag Manager -->
	<a name="top"></a>
	
	<div class='headerBox'>
	<div class="header">
		<div class='content'>
			<a href='https://dhtmlx.com' class='top_logo'></a>
			<div class='top_menu'>
				<a href="samples/index.html">Samples</a>
				<a href="https://forum.dhtmlx.com/viewforum.php?f=6">Forum</a>
				<a href="https://dhtmlx.com/docs/technical-support.shtml">Support</a>
			</div>
			<span><a href='index.html' style="color:white">Documentation</a></span>
		</div>
	</div>
	</div>

	<div class="body">
		<div class="content">
		<div class="navigation">
			<div id="doc_navigation">
			<div class="search">
				<form method="get" action="search.php">
					<input type="text" accesskey="f" name="query" placeholder="Search the docs..." value="" autocomplete="off">
						<button type="submit"><img src="assets/common/search_icon.png"/></button>
				</form>
			</div>
			<ul><li class=" current"><a href="howtostart_dotnet_core.html">dhtmlxScheduler with ASP.NET Core</a></li><ul><li class="inner"><a href="howtostart_dotnet_core.html#step1creatingaproject">Step 1. Creating a project</a></li><li class="inner"><a href="howtostart_dotnet_core.html#step2addingschedulertothepage">Step 2. Adding Scheduler to the page</a></li><li class="inner"><a href="howtostart_dotnet_core.html#step3creatingmodelsanddatabase">Step 3. Creating models and database</a></li><li class="inner"><a href="howtostart_dotnet_core.html#step4implementingwebapi">Step 4. Implementing Web API</a></li><li class="inner"><a href="howtostart_dotnet_core.html#dynamicloading">Dynamic loading</a></li><li class="inner"><a href="howtostart_dotnet_core.html#recurringevents">Recurring events</a></li><li class="inner"><a href="howtostart_dotnet_core.html#errorhandling">Error handling</a></li><li class="inner"><a href="howtostart_dotnet_core.html#applicationsecurity">Application security</a></li><li class="inner"><a href="howtostart_dotnet_core.html#troubleshooting">Trouble shooting</a></li><li class="inner"><a href="howtostart_dotnet_core.html#whatsnext">What's next</a></li></ul><li class=""><a href="howtostart_nodejs.html">dhtmlxScheduler with Node.js</a></li><li class=""><a href="howtostart_dotnet.html">dhtmlxScheduler with ASP.NET MVC</a></li><li class=""><a href="howtostart_plain_php.html">dhtmlxScheduler with PHP</a></li><li class=""><a href="howtostart_php_laravel.html">dhtmlxScheduler with PHP:Laravel</a></li><li class=""><a href="howtostart_php_slim4.html">dhtmlxScheduler with PHP:Slim</a></li><li class=""><a href="howtostart_ruby.html">dhtmlxScheduler with Ruby on Rails</a></li><li class=""><a href="howtostart_connector.html">dhtmlxScheduler with dhtmlxConnector</a></li><li class=""><a href="howtostart_php.html">dhtmlxScheduler with PHP:Slim 3</a></li></ul>
			</div>
		</div>	  
	  
		<div class='doc' id='doc_content'>
			
			
			<div class='breadcrumb'><a class="n1" href="index.html">Start</a><a class="n2" href="guides.html">Guides</a><a class="n3" href="howtostart_guides.html">How to Start with dhtmlxScheduler</a></div>
<!-- Content Area -->



<h1>dhtmlxScheduler with ASP.NET Core</h1>

<p>This tutorial gives you step-by-step instructions on how to create Scheduler with <a href="https://www.asp.net/">ASP.NET</a> Core on the server side.</p>

<p>You can also read tutorials on other server-side technologies:</p>

<ul>
<li><a class="link-" href="howtostart_dotnet.html">dhtmlxScheduler with ASP.NET MVC</a></li>
<li><a class="link-" href="howtostart_nodejs.html">dhtmlxScheduler with Node.js</a></li>
<li><a class="link-" href="howtostart_plain_php.html">dhtmlxScheduler with PHP</a></li>
<li><a class="link-" href="howtostart_php_slim4.html">dhtmlxScheduler with PHP:Slim</a></li>
<li><a class="link-" href="howtostart_php_laravel.html">dhtmlxScheduler with PHP:Laravel</a></li>
<li><a class="link-" href="howtostart_ruby.html">dhtmlxScheduler with Ruby on Rails</a></li>
<li><a class="link-" href="howtostart_connector.html">dhtmlxScheduler with dhtmlxConnector</a></li>
</ul>

<p>To organize communication with database, the <a href="https://docs.microsoft.com/en-us/ef/core/">Entity Framework Core</a> is used. The application is built with the help of the Visual Studio 2017.</p>

<div class='note'><p><p>The complete source code is <a href="https://github.com/DHTMLX/scheduler-howto-dotnet-core">available on GitHub</a>.</p>
</p></div>

<a name='step1creatingaproject'><h2>Step 1. Creating a project</h2></a>

<p>Launch Visual Studio 2017 and create a new project. Open the <strong>File</strong> menu and select: <em>New -> Project</em>.</p>

<p>Next select ASP.NET Core Web Application and name it <em>SchedulerApp</em>.</p>

<p><img src="media/howtostart_dotnetcore_newapp.png" alt="Scheduler App" /></p>

<p>Select an API template.</p>

<p><img src="media/howtostart_dotnetcore_apitemplate.png" alt="API template" /></p>

<p>Thus you've created a project and can proceed to add markup and script for Scheduler.</p>

<a name='step2addingschedulertothepage'><h2>Step 2. Adding Scheduler to the page</h2></a>

<p>Go to <strong>wwwroot</strong> and create an <em>index.html</em> file.</p>

<p><img src="media/howtostart_dotnetcore_indexpage.png" alt="Explorer" /></p>

<p>In the newly created file make a simple page for a scheduler chart.</p>

<p>Note, that scheduler files are <a class="link-" href="install_with_bower.html#cdn">added from CDN</a> in this demo. If you use the Professional version of the component, you'll need to 
<a class="link-" href="install_with_bower.html#addingproeditionintoproject">add scheduler files to the project manually</a>.</p>

<p class='snippet'> index.html</p>

<pre><code><pre class="js"><span class="sy0">&lt;!</span>DOCTYPE html<span class="sy0">&gt;</span>
<span class="sy0">&lt;</span>html<span class="sy0">&gt;</span>
<span class="sy0">&lt;</span>head<span class="sy0">&gt;</span>
    <span class="sy0">&lt;</span>title<span class="sy0">&gt;</span>Getting started <span class="kw1">with</span> dhtmlxScheduler<span class="sy0">&lt;/</span>title<span class="sy0">&gt;</span>
    <span class="sy0">&lt;</span>meta charset<span class="sy0">=</span><span class="st0">&quot;utf-8&quot;</span><span class="sy0">&gt;</span>
    <span class="sy0">&lt;</span>script src<span class="sy0">=</span><span class="st0">&quot;https://cdn.dhtmlx.com/scheduler/edge/dhtmlxscheduler.js&quot;</span><span class="sy0">&gt;&lt;/</span>script<span class="sy0">&gt;</span>
    <span class="sy0">&lt;</span>link href<span class="sy0">=</span><span class="st0">&quot;https://cdn.dhtmlx.com/scheduler/edge/dhtmlxscheduler_material.css&quot;</span> 
        rel<span class="sy0">=</span><span class="st0">&quot;stylesheet&quot;</span> type<span class="sy0">=</span><span class="st0">&quot;text/css&quot;</span> charset<span class="sy0">=</span><span class="st0">&quot;utf-8&quot;</span><span class="sy0">&gt;</span>
    <span class="sy0">&lt;</span>style<span class="sy0">&gt;</span>
        html<span class="sy0">,</span> body <span class="br0">&#123;</span>
            margin<span class="sy0">:</span> 0px<span class="sy0">;</span>
            padding<span class="sy0">:</span> 0px<span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="sy0">&lt;/</span>style<span class="sy0">&gt;</span>
<span class="sy0">&lt;/</span>head<span class="sy0">&gt;</span>
<span class="sy0">&lt;</span>body<span class="sy0">&gt;</span>
  <span class="sy0">&lt;</span>div id<span class="sy0">=</span><span class="st0">&quot;scheduler_here&quot;</span> <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_container&quot;</span> style<span class="sy0">=</span><span class="st0">'width:100%; height:100vh;'</span><span class="sy0">&gt;</span>
        <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_navline&quot;</span><span class="sy0">&gt;</span>
            <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_prev_button&quot;</span><span class="sy0">&gt;&amp;</span>nbsp<span class="sy0">;&lt;/</span>div<span class="sy0">&gt;</span>
            <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_next_button&quot;</span><span class="sy0">&gt;&amp;</span>nbsp<span class="sy0">;&lt;/</span>div<span class="sy0">&gt;</span>
            <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_today_button&quot;</span><span class="sy0">&gt;&lt;/</span>div<span class="sy0">&gt;</span>
            <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_date&quot;</span><span class="sy0">&gt;&lt;/</span>div<span class="sy0">&gt;</span>
            <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_tab&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;day_tab&quot;</span><span class="sy0">&gt;&lt;/</span>div<span class="sy0">&gt;</span>
            <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_tab&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;week_tab&quot;</span><span class="sy0">&gt;&lt;/</span>div<span class="sy0">&gt;</span>
            <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_tab&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;month_tab&quot;</span><span class="sy0">&gt;&lt;/</span>div<span class="sy0">&gt;</span>
        <span class="sy0">&lt;/</span>div<span class="sy0">&gt;</span>
        <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_header&quot;</span><span class="sy0">&gt;&lt;/</span>div<span class="sy0">&gt;</span>
        <span class="sy0">&lt;</span>div <span class="kw2">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_data&quot;</span><span class="sy0">&gt;&lt;/</span>div<span class="sy0">&gt;</span>
  <span class="sy0">&lt;/</span>div<span class="sy0">&gt;</span>
    <span class="sy0">&lt;</span>script<span class="sy0">&gt;</span>
        scheduler.<span class="me1">init</span><span class="br0">&#40;</span><span class="st0">'scheduler_here'</span><span class="sy0">,</span> <span class="kw2">new</span> Date<span class="br0">&#40;</span><span class="nu0">2019</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">20</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st0">&quot;week&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="sy0">&lt;/</span>script<span class="sy0">&gt;</span>
<span class="sy0">&lt;/</span>body<span class="sy0">&gt;</span>
<span class="sy0">&lt;/</span>html<span class="sy0">&gt;</span></pre></code></pre>

<p>Next go to <strong>Startup.cs</strong> and tell the application to use the <strong>index.html</strong> page. In order to do so, we need to configure the app to serve static files from the <em>wwwroot</em> folder.
It's done in the <code>Configure</code> method by calling the <code>app.UseStaticFiles()</code> method. 
You can <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files?view=aspnetcore-2.1&tabs=aspnetcore2x">find more details here</a>.</p>

<p>You also need to add the required middleware to <strong>Startup.cs</strong>, by replacing the "Hello world" stub in the <code>Configure()</code> method with two highlighted lines of code:</p>

<p class='snippet'> Startup.cs </p>

<pre><code><pre class="js">using Microsoft.<span class="me1">AspNetCore</span>.<span class="me1">Builder</span><span class="sy0">;</span>
using Microsoft.<span class="me1">AspNetCore</span>.<span class="me1">Hosting</span><span class="sy0">;</span>
using Microsoft.<span class="me1">AspNetCore</span>.<span class="me1">Mvc</span><span class="sy0">;</span>
using Microsoft.<span class="me1">Extensions</span>.<span class="me1">Configuration</span><span class="sy0">;</span>
using Microsoft.<span class="me1">Extensions</span>.<span class="me1">DependencyInjection</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">class</span> Startup
    <span class="br0">&#123;</span>
        <span class="kw2">public</span> Startup<span class="br0">&#40;</span>IConfiguration configuration<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            Configuration <span class="sy0">=</span> configuration<span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="kw2">public</span> IConfiguration Configuration <span class="br0">&#123;</span> get<span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp;
        <span class="co1">// This method gets called by the runtime. </span>
        <span class="co1">// Use it to add services to the container.</span>
        <span class="kw2">public</span> <span class="kw1">void</span> ConfigureServices<span class="br0">&#40;</span>IServiceCollection services<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
          services.<span class="me1">AddMvc</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">SetCompatibilityVersion</span><span class="br0">&#40;</span>CompatibilityVersion.<span class="me1">Version_2_1</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="co1">// This method gets called by the runtime. </span>
        <span class="co1">// Use it to configure the HTTP request pipeline.</span>
        <span class="kw2">public</span> <span class="kw1">void</span> Configure<span class="br0">&#40;</span>IApplicationBuilder app<span class="sy0">,</span> IHostingEnvironment env<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>env.<span class="me1">IsDevelopment</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
            <span class="br0">&#123;</span>
                app.<span class="me1">UseDeveloperExceptionPage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
            <span class="kw1">else</span>
            <span class="br0">&#123;</span>
                app.<span class="me1">UseHsts</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
<span class="xtra ln-xtra">            app.<span class="me1">UseDefaultFiles</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> </span><span class="xtra ln-xtra">            app.<span class="me1">UseStaticFiles</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>  </span>&nbsp;
            app.<span class="me1">UseHttpsRedirection</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            app.<span class="me1">UseMvc</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>The 2 added middleware are:</p>

<ul>
<li><p><code>app.UseDefaultFiles()</code> – allows serving default files. It will search the <strong>wwwroot</strong> folder for the following files:</p>

<ul>
<li>index.html</li>
<li>index.htm</li>
<li>default.html</li>
<li>default.htm
Thus, you can choose any of them, while in this tutorial "index.html" is used.
<code>UseDefaultFiles()</code> is just an URL-rewriter that doesn't actually serve the file. For this purpose you need to also add the <code>UseStaticFiles()</code> file.</li>
</ul></li>
<li><p><code>app.UseStaticFiles()</code> – is responsible for serving all <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/static-files?view=aspnetcore-2.1">static files present in the <strong>wwwroot</strong> folder</a>.</p></li>
</ul>

<p>Once you are done with it, an empty scheduler should appear on the page when you run the application.</p>

<p><img src="media/howtostart_dotnetcore_init.png" alt="Scheduler init" /></p>

<p>Next steps will show you how to create a backend API and connect scheduler to it.</p>

<a name='step3creatingmodelsanddatabase'><h2>Step 3. Creating models and database</h2></a>

<p>Let's begin with data model. You'll need a class for scheduler events. dhtmlxScheduler uses <a class="link-" href="data_formats.html#json">non-conventional names for model properties</a> from the .NET world perspective.</p>

<p>To deal with this, the <a href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/data/using-web-api-with-entity-framework/part-5">Data Transfer Object (DTO)</a> pattern will be used. Two kinds of models will be defined:</p>

<ul>
<li>domain model classes that will be used with EF Core and inside the app</li>
<li>DTO classes that will be used to communicate with Web API.</li>
</ul>

<p>Then mapping between the two models should be implemented.</p>

<h3>Models</h3>

<p>Create a new folder called <strong>Models</strong> in the project folder. This is where model classes and EF context will be implemented.</p>

<h3>Event Model</h3>

<p>First, create a class for events of the calendar. Create a file in the Models folder and name it <strong>SchedulerEvent.cs</strong>.</p>

<p>This is how the model can look like:</p>

<p class='snippet'> SchedulerApp/Models/SchedulerEvent.cs</p>

<pre><code><pre class="js">using System<span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp.<span class="me1">Models</span>
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">class</span> SchedulerEvent
    <span class="br0">&#123;</span>
        <span class="kw2">public</span> int Id <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> string <span class="kw3">Name</span> <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> DateTime StartDate <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> DateTime EndDate <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>Note, that scheduler events can have all kinds of additional properties, which can be utilized in the calendar. We're showing you the basic stuff here.</p>

<h3>Database context</h3>

<p>Firstly, we need to install the Entity Framework for ASP.NET Core. You can either do it via the NuGet package manager:</p>

<p><img src="media/howtostart_dotnetcore_enitityvianuget.png" alt="Entity via Nuget" /></p>

<p>Or use the Package Manager command line:</p>

<pre><code><pre class="js">PM<span class="sy0">&gt;</span> Install<span class="sy0">-</span><span class="kw2">Package</span> Microsoft.<span class="me1">EntityFrameworkCore</span>.<span class="me1">SqlServer</span></pre></code></pre>

<p>The Entity Framework Core will be used to manage communication of the app with a database.</p>

<h3>Creating Entity Context</h3>

<p>Next you need to define a session with the database and enable loading and saving data. For this, create a Context class:</p>

<ul>
<li>add the <strong>SchedulerContext.cs</strong> file in the <strong>Models</strong> folder </li>
<li>define the database context:</li>
</ul>

<p class='snippet'> SchedulerApp/Models/SchedulerContext.cs</p>

<pre><code><pre class="js">using Microsoft.<span class="me1">EntityFrameworkCore</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp.<span class="me1">Models</span>
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">class</span> SchedulerContext <span class="sy0">:</span> DbContext
    <span class="br0">&#123;</span>
        <span class="kw2">public</span> SchedulerContext<span class="br0">&#40;</span>DbContextOptions<span class="sy0">&lt;</span>SchedulerContext<span class="sy0">&gt;</span> options<span class="br0">&#41;</span>
           <span class="sy0">:</span> base<span class="br0">&#40;</span>options<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
        <span class="br0">&#125;</span>
        <span class="kw2">public</span> DbSet<span class="sy0">&lt;</span>SchedulerEvent<span class="sy0">&gt;</span> Events <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp;
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<h3>Adding first records to database</h3>

<p>Now we can add records to the database. Let's create the database initializer that will populate the database with events.</p>

<p>In the <strong>Models</strong> folder define a class and call it <strong>SchedulerSeeder</strong>. The class will have the <strong>Seed()</strong> method that will add events and links to the database.</p>

<p class='snippet'> SchedulerApp/Models/SchedulerSeeder.cs</p>

<pre><code><pre class="js">using System<span class="sy0">;</span>
using System.<span class="me1">Collections</span>.<span class="me1">Generic</span><span class="sy0">;</span>
using System.<span class="me1">Linq</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp.<span class="me1">Models</span>
<span class="br0">&#123;</span>
    <span class="kw2">public</span> static <span class="kw2">class</span> SchedulerSeeder
    <span class="br0">&#123;</span>
        <span class="kw2">public</span> static <span class="kw1">void</span> Seed<span class="br0">&#40;</span>SchedulerContext context<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>context.<span class="me1">Events</span>.<span class="me1">Any</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
            <span class="br0">&#123;</span>
                <span class="kw1">return</span><span class="sy0">;</span>   <span class="co1">// DB has been seeded</span>
            <span class="br0">&#125;</span>
&nbsp;
            <span class="kw2">var</span> events <span class="sy0">=</span> <span class="kw2">new</span> List<span class="sy0">&lt;</span>SchedulerEvent<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
            <span class="br0">&#123;</span>
                <span class="kw2">new</span> SchedulerEvent
                <span class="br0">&#123;</span>
                    <span class="kw3">Name</span> <span class="sy0">=</span> <span class="st0">&quot;Event 1&quot;</span><span class="sy0">,</span>
                    StartDate <span class="sy0">=</span> <span class="kw2">new</span> DateTime<span class="br0">&#40;</span><span class="nu0">2019</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">15</span><span class="sy0">,</span> <span class="nu0">2</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">,</span>
                    EndDate <span class="sy0">=</span> <span class="kw2">new</span> DateTime<span class="br0">&#40;</span><span class="nu0">2019</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">15</span><span class="sy0">,</span> <span class="nu0">4</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span>
                <span class="br0">&#125;</span><span class="sy0">,</span>
                <span class="kw2">new</span> SchedulerEvent<span class="br0">&#40;</span><span class="br0">&#41;</span>
                <span class="br0">&#123;</span>
                    <span class="kw3">Name</span> <span class="sy0">=</span> <span class="st0">&quot;Event 2&quot;</span><span class="sy0">,</span>
                    StartDate <span class="sy0">=</span> <span class="kw2">new</span> DateTime<span class="br0">&#40;</span><span class="nu0">2019</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">17</span><span class="sy0">,</span> <span class="nu0">3</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">,</span>
                    EndDate <span class="sy0">=</span> <span class="kw2">new</span> DateTime<span class="br0">&#40;</span><span class="nu0">2019</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">17</span><span class="sy0">,</span> <span class="nu0">6</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span>
                <span class="br0">&#125;</span><span class="sy0">,</span>
                <span class="kw2">new</span> SchedulerEvent<span class="br0">&#40;</span><span class="br0">&#41;</span>
                <span class="br0">&#123;</span>
                    <span class="kw3">Name</span> <span class="sy0">=</span> <span class="st0">&quot;Multiday event&quot;</span><span class="sy0">,</span>
                    StartDate <span class="sy0">=</span> <span class="kw2">new</span> DateTime<span class="br0">&#40;</span><span class="nu0">2019</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">15</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">,</span>
                    EndDate <span class="sy0">=</span> <span class="kw2">new</span> DateTime<span class="br0">&#40;</span><span class="nu0">2019</span><span class="sy0">,</span> <span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">20</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">&#41;</span>
                <span class="br0">&#125;</span>
            <span class="br0">&#125;</span><span class="sy0">;</span>
&nbsp;
            events.<span class="me1">ForEach</span><span class="br0">&#40;</span>s <span class="sy0">=&gt;</span> context.<span class="me1">Events</span>.<span class="me1">Add</span><span class="br0">&#40;</span>s<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            context.<span class="me1">SaveChanges</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<h3>Registering Database</h3>

<p>Now you should register the database in <strong>Startup.cs</strong>. But first you need a connection string for it. It will be stored
<a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-2.1&tabs=basicconfiguration#configuration-by-environment">in a JSON file in the application settings</a>. 
If you used <code>API</code> template when created the project, this file should already exist in project folder. If you used <code>Empty template</code>, you’ll need to create one.</p>

<p>Create the <em>appsettings.json</em> file (or open it if we have it already) and add a connection string to the database:</p>

<p class='snippet'> appsettings.json </p>

<pre><code><pre class="js"><span class="br0">&#123;</span>
  <span class="st0">&quot;ConnectionStrings&quot;</span><span class="sy0">:</span> <span class="br0">&#123;</span>
    <span class="st0">&quot;DefaultConnection&quot;</span><span class="sy0">:</span><span class="st0">&quot;Server=(localdb)<span class="es0">\\</span>mssqllocaldb;
        Database=SchedulerDatabase;Trusted_Connection=True;&quot;</span>  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>After that you can register the database context via 
<a href="https://docs.microsoft.com/en-us/ef/core/get-started/aspnetcore/new-db?view=aspnetcore-2.1&tabs=visual-studio#register-your-context-with-dependency-injection">dependency injection</a>.</p>

<p>Add the following namespaces to <strong>Startup.cs</strong>:</p>

<p class='snippet'> Startup.cs </p>

<pre><code><pre class="js">using Microsoft.<span class="me1">EntityFrameworkCore</span><span class="sy0">;</span>
using SchedulerApp.<span class="me1">Models</span><span class="sy0">;</span>
using Microsoft.<span class="me1">Extensions</span>.<span class="me1">Configuration</span><span class="sy0">;</span></pre></code></pre>

<p>The declaration will look like this:</p>

<p class='snippet'> Startup.cs </p>

<pre><code><pre class="js"><span class="kw2">public</span> IConfiguration Configuration <span class="br0">&#123;</span> get<span class="sy0">;</span> <span class="br0">&#125;</span>
<span class="kw2">public</span> Startup<span class="br0">&#40;</span>IConfiguration configuration<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    Configuration <span class="sy0">=</span> configuration<span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">public</span> <span class="kw1">void</span> ConfigureServices<span class="br0">&#40;</span>IServiceCollection services<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    services.<span class="me1">AddDbContext</span><span class="sy0">&lt;</span>SchedulerContext<span class="sy0">&gt;</span><span class="br0">&#40;</span>options <span class="sy0">=&gt;</span> 
        options.<span class="me1">UseSqlServer</span><span class="br0">&#40;</span>Configuration.<span class="me1">GetConnectionString</span><span class="br0">&#40;</span><span class="st0">&quot;DefaultConnection&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>Here is the complete code of <strong>Startup.cs</strong>:</p>

<p class='snippet'> Startup.cs </p>

<pre><code><pre class="js">using Microsoft.<span class="me1">AspNetCore</span>.<span class="me1">Builder</span><span class="sy0">;</span>
using Microsoft.<span class="me1">AspNetCore</span>.<span class="me1">Hosting</span><span class="sy0">;</span>
using Microsoft.<span class="me1">Extensions</span>.<span class="me1">DependencyInjection</span><span class="sy0">;</span>
&nbsp;
using Microsoft.<span class="me1">EntityFrameworkCore</span><span class="sy0">;</span>
using DHX.<span class="me1">Scheduler</span>.<span class="me1">Models</span><span class="sy0">;</span>
using Microsoft.<span class="me1">Extensions</span>.<span class="me1">Configuration</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> DHX.<span class="me1">Scheduler</span>
<span class="br0">&#123;</span>
 <span class="kw2">public</span> <span class="kw2">class</span> Startup
   <span class="br0">&#123;</span>
    <span class="kw2">public</span> IConfiguration Configuration <span class="br0">&#123;</span> get<span class="sy0">;</span> <span class="br0">&#125;</span>
    <span class="kw2">public</span> Startup<span class="br0">&#40;</span>IConfiguration configuration<span class="br0">&#41;</span>
     <span class="br0">&#123;</span>
        Configuration <span class="sy0">=</span> configuration<span class="sy0">;</span>
     <span class="br0">&#125;</span>
&nbsp;
&nbsp;
     <span class="co1">//This method is called by the runtime. Use it to add services to the container.</span>
     <span class="co1">//More info on app config here - https://go.microsoft.com/fwlink/?LinkID=398940</span>
     <span class="kw2">public</span> <span class="kw1">void</span> ConfigureServices<span class="br0">&#40;</span>IServiceCollection services<span class="br0">&#41;</span>
     <span class="br0">&#123;</span>
       services.<span class="me1">AddDbContext</span><span class="sy0">&lt;</span>SchedulerContext<span class="sy0">&gt;</span><span class="br0">&#40;</span>options <span class="sy0">=&gt;</span> 
         options.<span class="me1">UseSqlServer</span><span class="br0">&#40;</span>Configuration.<span class="me1">GetConnectionString</span><span class="br0">&#40;</span><span class="st0">&quot;DefaultConnection&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
     <span class="br0">&#125;</span>
&nbsp;
     <span class="co1">//The method is called by the runtime. Use it to configure HTTP request pipeline.</span>
     <span class="kw2">public</span> <span class="kw1">void</span> Configure<span class="br0">&#40;</span>IApplicationBuilder app<span class="sy0">,</span> IHostingEnvironment env<span class="br0">&#41;</span>
     <span class="br0">&#123;</span>
       <span class="kw1">if</span> <span class="br0">&#40;</span>env.<span class="me1">IsDevelopment</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
       <span class="br0">&#123;</span>
          app.<span class="me1">UseDeveloperExceptionPage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
       <span class="br0">&#125;</span>
&nbsp;
       app.<span class="me1">UseDefaultFiles</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
       app.<span class="me1">UseStaticFiles</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
     <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>Finally, you need to initialize and seed the database on the app startup. Normally, we'd want to use migrations for that, but for simplicity they aren't used here.</p>

<p>Let's begin with creating a class where initialization will be done. Create the <strong>SchedulerInitializerExtension.cs</strong> file in the <strong>Models</strong> folder:</p>

<p class='snippet'> Models/SchedulerInitializerExtension.cs</p>

<pre><code><pre class="js">using Microsoft.<span class="me1">Extensions</span>.<span class="me1">DependencyInjection</span><span class="sy0">;</span>
using Microsoft.<span class="me1">AspNetCore</span>.<span class="me1">Hosting</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp.<span class="me1">Models</span>
<span class="br0">&#123;</span>
 <span class="kw2">public</span> static <span class="kw2">class</span> SchedulerInitializerExtension
   <span class="br0">&#123;</span>
    <span class="kw2">public</span> static IWebHost InitializeDatabase<span class="br0">&#40;</span><span class="kw1">this</span> IWebHost webHost<span class="br0">&#41;</span>
     <span class="br0">&#123;</span>
      <span class="kw2">var</span> serviceScopeFactory <span class="sy0">=</span>
      <span class="br0">&#40;</span>IServiceScopeFactory<span class="br0">&#41;</span>webHost.<span class="me1">Services</span>.<span class="me1">GetService</span><span class="br0">&#40;</span><span class="kw1">typeof</span><span class="br0">&#40;</span>IServiceScopeFactory<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        using <span class="br0">&#40;</span><span class="kw2">var</span> scope <span class="sy0">=</span> serviceScopeFactory.<span class="me1">CreateScope</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
           <span class="kw2">var</span> services <span class="sy0">=</span> scope.<span class="me1">ServiceProvider</span><span class="sy0">;</span>
           <span class="kw2">var</span> dbContext <span class="sy0">=</span> services.<span class="me1">GetRequiredService</span><span class="sy0">&lt;</span>SchedulerContext<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
           dbContext.<span class="me1">Database</span>.<span class="me1">EnsureCreated</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
           SchedulerSeeder.<span class="me1">Seed</span><span class="br0">&#40;</span>dbContext<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="kw1">return</span> webHost<span class="sy0">;</span>
     <span class="br0">&#125;</span>
   <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>Next call <strong>InitializeDatabase()</strong> in the <strong>Program.Main</strong> pipeline:</p>

<p class='snippet'> Program.cs </p>

<pre><code><pre class="js">using Microsoft.<span class="me1">AspNetCore</span><span class="sy0">;</span>
using Microsoft.<span class="me1">AspNetCore</span>.<span class="me1">Hosting</span><span class="sy0">;</span>
using SchedulerApp.<span class="me1">Models</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">class</span> Program
    <span class="br0">&#123;</span>
        <span class="kw2">public</span> static <span class="kw1">void</span> Main<span class="br0">&#40;</span>string<span class="br0">&#91;</span><span class="br0">&#93;</span> args<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            CreateWebHostBuilder<span class="br0">&#40;</span>args<span class="br0">&#41;</span>
                .<span class="me1">Build</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
                .<span class="me1">InitializeDatabase</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="co1">//!</span>
                .<span class="me1">Run</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="kw2">public</span> static IWebHostBuilder CreateWebHostBuilder<span class="br0">&#40;</span>string<span class="br0">&#91;</span><span class="br0">&#93;</span> args<span class="br0">&#41;</span> <span class="sy0">=&gt;</span>
            WebHost.<span class="me1">CreateDefaultBuilder</span><span class="br0">&#40;</span>args<span class="br0">&#41;</span>
                .<span class="me1">UseStartup</span><span class="sy0">&lt;</span>Startup<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>The current part is finished, let's return to Scheduler.</p>

<h3>Define DTOs and Mapping</h3>

<p>It is high time to define DTO classes that will be used for Web API. Let's begin with the DTO class for SchedulerEvent. In the <strong>Models</strong> folder create a file and define the <strong>WebAPIEvent.cs</strong> class:</p>

<p class='snippet'> Models/WebApiEvent.cs</p>

<pre><code><pre class="js">using System<span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp.<span class="me1">Models</span>
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">class</span> WebAPIEvent
    <span class="br0">&#123;</span>
        <span class="kw2">public</span> int id <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> string text <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> string start_date <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> string end_date <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp;
        <span class="kw2">public</span> static explicit operator WebAPIEvent<span class="br0">&#40;</span>SchedulerEvent ev<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw1">return</span> <span class="kw2">new</span> WebAPIEvent
            <span class="br0">&#123;</span>
                id <span class="sy0">=</span> ev.<span class="me1">Id</span><span class="sy0">,</span>
                text <span class="sy0">=</span> ev.<span class="kw3">Name</span><span class="sy0">,</span>
                start_date <span class="sy0">=</span> ev.<span class="me1">StartDate</span>.<span class="me1">ToString</span><span class="br0">&#40;</span><span class="st0">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="br0">&#41;</span><span class="sy0">,</span>
                end_date <span class="sy0">=</span> ev.<span class="me1">EndDate</span>.<span class="me1">ToString</span><span class="br0">&#40;</span><span class="st0">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="br0">&#41;</span>
            <span class="br0">&#125;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="kw2">public</span> static explicit operator SchedulerEvent<span class="br0">&#40;</span>WebAPIEvent ev<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw1">return</span> <span class="kw2">new</span> SchedulerEvent
            <span class="br0">&#123;</span>
                Id <span class="sy0">=</span> ev.<span class="me1">id</span><span class="sy0">,</span>
                <span class="kw3">Name</span> <span class="sy0">=</span> ev.<span class="me1">text</span><span class="sy0">,</span>
                StartDate <span class="sy0">=</span> DateTime.<span class="me1">Parse</span><span class="br0">&#40;</span>ev.<span class="me1">start_date</span><span class="sy0">,</span>
                    System.<span class="me1">Globalization</span>.<span class="me1">CultureInfo</span>.<span class="me1">InvariantCulture</span><span class="br0">&#41;</span><span class="sy0">,</span>
                EndDate <span class="sy0">=</span> DateTime.<span class="me1">Parse</span><span class="br0">&#40;</span>ev.<span class="me1">end_date</span><span class="sy0">,</span>
                    System.<span class="me1">Globalization</span>.<span class="me1">CultureInfo</span>.<span class="me1">InvariantCulture</span><span class="br0">&#41;</span>
            <span class="br0">&#125;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>When you finish this step, you should get the following folder structure:</p>

<p><img src="media/howtostart_dotnetcore_models.png" alt="Models" /></p>

<p>Now we can run the app in order to check that everything is in place. If we don't see a runtime error, then everything is fine.</p>

<a name='step4implementingwebapi'><h2>Step 4. Implementing Web API</h2></a>

<p>Now it's time for the actual REST API implementation. Go to <strong>Startup.cs</strong> and enable MVC routing, if it's not enabled yet:</p>

<p class='snippet'> Startup.cs</p>

<pre><code><pre class="js"><span class="kw2">public</span> <span class="kw1">void</span> ConfigureServices<span class="br0">&#40;</span>IServiceCollection services<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
<span class="xtra ln-xtra">  services.<span class="me1">AddMvc</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">SetCompatibilityVersion</span><span class="br0">&#40;</span>CompatibilityVersion.<span class="me1">Version_2_1</span><span class="br0">&#41;</span><span class="sy0">;</span> </span>  services.<span class="me1">AddDbContext</span><span class="sy0">&lt;</span>SchedulerContext<span class="sy0">&gt;</span><span class="br0">&#40;</span>options <span class="sy0">=&gt;</span>
     options.<span class="me1">UseSqlServer</span><span class="br0">&#40;</span>Configuration.<span class="me1">GetConnectionString</span><span class="br0">&#40;</span><span class="st0">&quot;DefaultConnection&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">public</span> <span class="kw1">void</span> Configure<span class="br0">&#40;</span>IApplicationBuilder app<span class="sy0">,</span> IHostingEnvironment env<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <span class="kw1">if</span> <span class="br0">&#40;</span>env.<span class="me1">IsDevelopment</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
   <span class="br0">&#123;</span>
      app.<span class="me1">UseDeveloperExceptionPage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   <span class="br0">&#125;</span>
   <span class="kw1">else</span>
   <span class="br0">&#123;</span>
      app.<span class="me1">UseHsts</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   <span class="br0">&#125;</span>
   app.<span class="me1">UseDefaultFiles</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   app.<span class="me1">UseStaticFiles</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
   app.<span class="me1">UseHttpsRedirection</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="xtra ln-xtra">   app.<span class="me1">UseMvc</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></span><span class="br0">&#125;</span></pre></code></pre>

<h3>Adding API Controller</h3>

<p>Create the <strong>Controllers</strong> folder and create an empty API controller for our events::</p>

<p class='snippet'> Controllers/EventController.cs</p>

<pre><code><pre class="js">using System.<span class="me1">Collections</span>.<span class="me1">Generic</span><span class="sy0">;</span>
using System.<span class="me1">Linq</span><span class="sy0">;</span>
using Microsoft.<span class="me1">AspNetCore</span>.<span class="me1">Mvc</span><span class="sy0">;</span>
using SchedulerApp.<span class="me1">Models</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp.<span class="me1">Controllers</span>
<span class="br0">&#123;</span>
    <span class="br0">&#91;</span>Route<span class="br0">&#40;</span><span class="st0">&quot;api/[controller]&quot;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
    <span class="br0">&#91;</span>ApiController<span class="br0">&#93;</span>
    <span class="kw2">public</span> <span class="kw2">class</span> EventsController <span class="sy0">:</span> ControllerBase
    <span class="br0">&#123;</span>
        <span class="kw2">private</span> readonly SchedulerContext _context<span class="sy0">;</span>
        <span class="kw2">public</span> EventsController<span class="br0">&#40;</span>SchedulerContext context<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            _context <span class="sy0">=</span> context<span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="co1">// GET api/events</span>
        <span class="br0">&#91;</span>HttpGet<span class="br0">&#93;</span>
        <span class="kw2">public</span> IEnumerable<span class="sy0">&lt;</span>WebAPIEvent<span class="sy0">&gt;</span> Get<span class="br0">&#40;</span><span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw1">return</span> _context.<span class="me1">Events</span>
                .<span class="me1">ToList</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
                .<span class="me1">Select</span><span class="br0">&#40;</span>e <span class="sy0">=&gt;</span> <span class="br0">&#40;</span>WebAPIEvent<span class="br0">&#41;</span>e<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="co1">// GET api/events/5</span>
        <span class="br0">&#91;</span>HttpGet<span class="br0">&#40;</span><span class="st0">&quot;{id}&quot;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
        <span class="kw2">public</span> WebAPIEvent Get<span class="br0">&#40;</span>int id<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw1">return</span> <span class="br0">&#40;</span>WebAPIEvent<span class="br0">&#41;</span>_context
                .<span class="me1">Events</span>
                .<span class="me1">Find</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="co1">// POST api/events</span>
        <span class="br0">&#91;</span>HttpPost<span class="br0">&#93;</span>
        <span class="kw2">public</span> ObjectResult Post<span class="br0">&#40;</span><span class="br0">&#91;</span>FromForm<span class="br0">&#93;</span> WebAPIEvent apiEvent<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw2">var</span> newEvent <span class="sy0">=</span> <span class="br0">&#40;</span>SchedulerEvent<span class="br0">&#41;</span>apiEvent<span class="sy0">;</span>
&nbsp;
            _context.<span class="me1">Events</span>.<span class="me1">Add</span><span class="br0">&#40;</span>newEvent<span class="br0">&#41;</span><span class="sy0">;</span>
            _context.<span class="me1">SaveChanges</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
            <span class="kw1">return</span> Ok<span class="br0">&#40;</span><span class="kw2">new</span>
            <span class="br0">&#123;</span>
                tid <span class="sy0">=</span> newEvent.<span class="me1">Id</span><span class="sy0">,</span>
                action <span class="sy0">=</span> <span class="st0">&quot;inserted&quot;</span>
            <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="co1">// PUT api/events/5</span>
        <span class="br0">&#91;</span>HttpPut<span class="br0">&#40;</span><span class="st0">&quot;{id}&quot;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
        <span class="kw2">public</span> ObjectResult Put<span class="br0">&#40;</span>int id<span class="sy0">,</span> <span class="br0">&#91;</span>FromForm<span class="br0">&#93;</span> WebAPIEvent apiEvent<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw2">var</span> updatedEvent <span class="sy0">=</span> <span class="br0">&#40;</span>SchedulerEvent<span class="br0">&#41;</span>apiEvent<span class="sy0">;</span>
            <span class="kw2">var</span> dbEvent <span class="sy0">=</span> _context.<span class="me1">Events</span>.<span class="me1">Find</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span><span class="sy0">;</span>
            dbEvent.<span class="kw3">Name</span> <span class="sy0">=</span> updatedEvent.<span class="kw3">Name</span><span class="sy0">;</span>
            dbEvent.<span class="me1">StartDate</span> <span class="sy0">=</span> updatedEvent.<span class="me1">StartDate</span><span class="sy0">;</span>
            dbEvent.<span class="me1">EndDate</span> <span class="sy0">=</span> updatedEvent.<span class="me1">EndDate</span><span class="sy0">;</span>
            _context.<span class="me1">SaveChanges</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
            <span class="kw1">return</span> Ok<span class="br0">&#40;</span><span class="kw2">new</span>
            <span class="br0">&#123;</span>
                action <span class="sy0">=</span> <span class="st0">&quot;updated&quot;</span>
            <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="co1">// DELETE api/events/5</span>
        <span class="br0">&#91;</span>HttpDelete<span class="br0">&#40;</span><span class="st0">&quot;{id}&quot;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
        <span class="kw2">public</span> ObjectResult DeleteEvent<span class="br0">&#40;</span>int id<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw2">var</span> e <span class="sy0">=</span> _context.<span class="me1">Events</span>.<span class="me1">Find</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>e <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span>
            <span class="br0">&#123;</span>
            _context.<span class="me1">Events</span>.<span class="me1">Remove</span><span class="br0">&#40;</span>e<span class="br0">&#41;</span><span class="sy0">;</span>
            _context.<span class="me1">SaveChanges</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
&nbsp;
            <span class="kw1">return</span> Ok<span class="br0">&#40;</span><span class="kw2">new</span>
            <span class="br0">&#123;</span>
                action <span class="sy0">=</span> <span class="st0">&quot;deleted&quot;</span>
            <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<h3>Configuring the Client</h3>

<p>Web API is done, now we can return to our HTML page and configure scheduler to make use of it:</p>

<p class='snippet'> wwwroot/index.html </p>

<pre><code><pre class="js">scheduler.<span class="me1">config</span>.<span class="me1">xml_date</span> <span class="sy0">=</span> <span class="st0">&quot;%Y-%m-%d %H:%i&quot;</span><span class="sy0">;</span>
scheduler.<span class="me1">init</span><span class="br0">&#40;</span><span class="st0">&quot;scheduler_here&quot;</span><span class="sy0">,</span> <span class="kw2">new</span> Date<span class="br0">&#40;</span><span class="nu0">2019</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">20</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st0">&quot;week&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// load data from backend</span>
scheduler.<span class="me1">load</span><span class="br0">&#40;</span><span class="st0">&quot;/api/events&quot;</span><span class="sy0">,</span> <span class="st0">&quot;json&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// connect backend to scheduler</span>
<span class="kw2">var</span> dp <span class="sy0">=</span> <span class="kw2">new</span> dataProcessor<span class="br0">&#40;</span><span class="st0">&quot;/api/events&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
dp.<span class="me1">init</span><span class="br0">&#40;</span>scheduler<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// set data exchange mode</span>
dp.<span class="me1">setTransactionMode</span><span class="br0">&#40;</span><span class="st0">&quot;REST&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<p>Everything is ready. You can run the application and see the fully-fledged Scheduler.</p>

<p><img src="media/howtostart_dotnetcore_webapi.png" alt="Scheduler CRUD" /></p>

<a name='dynamicloading'><h2>Dynamic loading</h2></a>

<p>Each time scheduler calls our <code>GET</code> action, it loads the whole events table. It may be ok for a start, but after the app is used for a several months the amount of data transferred will grow dramatically.
So it may be worthwhile to implement dynamic loading, which allows scheduler to load only a required events range.</p>

<p>On the client side it is enabled by the <code>scheduler.setLoadMode</code> method:</p>

<p class='snippet'> wwwroot/index.html </p>

<pre><code><pre class="js">scheduler.<span class="me1">setLoadMode</span><span class="br0">&#40;</span><span class="st0">&quot;day&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// load data from backend</span>
scheduler.<span class="me1">load</span><span class="br0">&#40;</span><span class="st0">&quot;/api/events&quot;</span><span class="sy0">,</span> <span class="st0">&quot;json&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<p>After that scheduler will start adding <code>from</code> and <code>to</code> date parameters to <code>GET</code> requests, so the backend could return only events between these dates.</p>

<p>All we need to do is to get these parameters in our <code>GET</code> action and to filter events appropriately:</p>

<p class='snippet'> Controllers/EventsController.cs </p>

<pre><code><pre class="js"><span class="co1">// GET api/events</span>
<span class="br0">&#91;</span>HttpGet<span class="br0">&#93;</span>
<span class="kw2">public</span> IEnumerable<span class="sy0">&lt;</span>WebAPIEvent<span class="sy0">&gt;</span> Get<span class="br0">&#40;</span><span class="br0">&#91;</span>FromQuery<span class="br0">&#93;</span> DateTime from<span class="sy0">,</span> <span class="br0">&#91;</span>FromQuery<span class="br0">&#93;</span> DateTime to<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw1">return</span> _context.<span class="me1">Events</span>
        .<span class="me1">Where</span><span class="br0">&#40;</span>e <span class="sy0">=&gt;</span> e.<span class="me1">StartDate</span> <span class="sy0">&lt;</span> to <span class="sy0">&amp;&amp;</span> e.<span class="me1">EndDate</span> <span class="sy0">&gt;=</span> from<span class="br0">&#41;</span>
        .<span class="me1">ToList</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
        .<span class="me1">Select</span><span class="br0">&#40;</span>e <span class="sy0">=&gt;</span> <span class="br0">&#40;</span>WebAPIEvent<span class="br0">&#41;</span>e<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<a name='recurringevents'><h2>Recurring events</h2></a>

<p>In order to enable recurrence (e.g. "repeat event daily") you'll need to add an appropriate extension to the scheduler page:</p>

<pre><code><pre class="js"><span class="sy0">&lt;</span>script src<span class="sy0">=</span><span class="st0">&quot;https://cdn.dhtmlx.com/scheduler/edge/ext/dhtmlxscheduler_recurring.js&quot;</span> <span class="sy0">&gt;&lt;/</span>script<span class="sy0">&gt;</span></pre></code></pre>

<h3>Updating the model</h3>

<p>We also need to update our model in order for it to store recurrence info:</p>

<p class='snippet'>  Models/SchedulerEvent.cs</p>

<pre><code><pre class="js">using System<span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp.<span class="me1">Models</span>
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">class</span> SchedulerEvent
    <span class="br0">&#123;</span>
        <span class="kw2">public</span> int Id <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> string <span class="kw3">Name</span> <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> DateTime StartDate <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> DateTime EndDate <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp;
<span class="xtra ln-xtra">        <span class="kw2">public</span> int EventPID <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span> </span><span class="xtra ln-xtra">        <span class="kw2">public</span> string RecType <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span> </span><span class="xtra ln-xtra">        <span class="kw2">public</span> long EventLength <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span> </span>&nbsp;
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>And the data transfer object:</p>

<p class='snippet'> Models/WebAPIEvent.cs </p>

<pre><code><pre class="js">using System<span class="sy0">;</span>
using System.<span class="me1">Text</span>.<span class="me1">Encodings</span>.<span class="me1">Web</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">namespace</span> SchedulerApp.<span class="me1">Models</span>
<span class="br0">&#123;</span>
    <span class="kw2">public</span> <span class="kw2">class</span> WebAPIEvent
    <span class="br0">&#123;</span>
        <span class="kw2">public</span> int id <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> string text <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> string start_date <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
        <span class="kw2">public</span> string end_date <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span>
&nbsp;
<span class="xtra ln-xtra">        <span class="kw2">public</span> int<span class="sy0">?</span> event_pid <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span> </span><span class="xtra ln-xtra">        <span class="kw2">public</span> string rec_type <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span> </span><span class="xtra ln-xtra">        <span class="kw2">public</span> long<span class="sy0">?</span> event_length <span class="br0">&#123;</span> get<span class="sy0">;</span> set<span class="sy0">;</span> <span class="br0">&#125;</span> </span>&nbsp;
        <span class="kw2">public</span> static explicit operator WebAPIEvent<span class="br0">&#40;</span>SchedulerEvent ev<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw1">return</span> <span class="kw2">new</span> WebAPIEvent
            <span class="br0">&#123;</span>
                id <span class="sy0">=</span> ev.<span class="me1">Id</span><span class="sy0">,</span>
                text <span class="sy0">=</span> HtmlEncoder.<span class="kw2">Default</span>.<span class="me1">Encode</span><span class="br0">&#40;</span>ev.<span class="kw3">Name</span><span class="br0">&#41;</span><span class="sy0">,</span> 
                start_date <span class="sy0">=</span> ev.<span class="me1">StartDate</span>.<span class="me1">ToString</span><span class="br0">&#40;</span><span class="st0">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="br0">&#41;</span><span class="sy0">,</span>
                end_date <span class="sy0">=</span> ev.<span class="me1">EndDate</span>.<span class="me1">ToString</span><span class="br0">&#40;</span><span class="st0">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="br0">&#41;</span><span class="sy0">,</span>
                event_pid  <span class="sy0">=</span> ev.<span class="me1">EventPID</span><span class="sy0">,</span>
                rec_type <span class="sy0">=</span> ev.<span class="me1">RecType</span><span class="sy0">,</span>
                event_length <span class="sy0">=</span> ev.<span class="me1">EventLength</span>
            <span class="br0">&#125;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
&nbsp;
        <span class="kw2">public</span> static explicit operator SchedulerEvent<span class="br0">&#40;</span>WebAPIEvent ev<span class="br0">&#41;</span>
        <span class="br0">&#123;</span>
            <span class="kw1">return</span> <span class="kw2">new</span> SchedulerEvent
            <span class="br0">&#123;</span>
                Id <span class="sy0">=</span> ev.<span class="me1">id</span><span class="sy0">,</span>
                <span class="kw3">Name</span> <span class="sy0">=</span> ev.<span class="me1">text</span><span class="sy0">,</span>
                StartDate <span class="sy0">=</span> DateTime.<span class="me1">Parse</span><span class="br0">&#40;</span>ev.<span class="me1">start_date</span><span class="sy0">,</span>
                    System.<span class="me1">Globalization</span>.<span class="me1">CultureInfo</span>.<span class="me1">InvariantCulture</span><span class="br0">&#41;</span><span class="sy0">,</span>
                EndDate <span class="sy0">=</span> DateTime.<span class="me1">Parse</span><span class="br0">&#40;</span>ev.<span class="me1">end_date</span><span class="sy0">,</span>
                    System.<span class="me1">Globalization</span>.<span class="me1">CultureInfo</span>.<span class="me1">InvariantCulture</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="co1">///</span>
                EventPID <span class="sy0">=</span> ev.<span class="me1">event_pid</span> <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">?</span> ev.<span class="me1">event_pid</span>.<span class="me1">Value</span> <span class="sy0">:</span> <span class="nu0">0</span><span class="sy0">,</span> 
                EventLength <span class="sy0">=</span> ev.<span class="me1">event_length</span> <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">?</span> ev.<span class="me1">event_length</span>.<span class="me1">Value</span> <span class="sy0">:</span> <span class="nu0">0</span><span class="sy0">,</span>
                RecType <span class="sy0">=</span> ev.<span class="me1">rec_type</span>
            <span class="br0">&#125;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<h3>Updating API controller</h3>

<p>Lastly, we need to modify our PUT/POST/DELETE actions in order to <a class="link-" href="recurring_events.html#editingdeletingacertainoccurrenceintheseries">handle special rules of recurring events</a>.
Firstly, let's take a look at the <code>POST</code> action.
We need to process a special case for recurring events - deletion of a specific occurrence of the recurring series requires creating a new database record and the client will call the <code>insert</code> action for it:</p>

<p class='snippet'> Controllers/EventsController.cs</p>

<pre><code><pre class="js"><span class="co1">// POST api/events</span>
<span class="br0">&#91;</span>HttpPost<span class="br0">&#93;</span>
<span class="kw2">public</span> ObjectResult Post<span class="br0">&#40;</span><span class="br0">&#91;</span>FromForm<span class="br0">&#93;</span> WebAPIEvent apiEvent<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <span class="kw2">var</span> newEvent <span class="sy0">=</span> <span class="br0">&#40;</span>SchedulerEvent<span class="br0">&#41;</span>apiEvent<span class="sy0">;</span>
&nbsp;
   _context.<span class="me1">Events</span>.<span class="me1">Add</span><span class="br0">&#40;</span>newEvent<span class="br0">&#41;</span><span class="sy0">;</span>
   _context.<span class="me1">SaveChanges</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="co1">// delete a single occurrence from a recurring series</span>
<span class="xtra ln-xtra">  <span class="kw2">var</span> resultAction <span class="sy0">=</span> <span class="st0">&quot;inserted&quot;</span><span class="sy0">;</span> </span><span class="xtra ln-xtra">  <span class="kw1">if</span><span class="br0">&#40;</span>newEvent.<span class="me1">RecType</span> <span class="sy0">==</span> <span class="st0">&quot;none&quot;</span><span class="br0">&#41;</span> </span>  <span class="br0">&#123;</span>
<span class="xtra ln-xtra">     resultAction <span class="sy0">=</span> <span class="st0">&quot;deleted&quot;</span><span class="sy0">;</span> </span>  <span class="br0">&#125;</span>
&nbsp;
  <span class="kw1">return</span> Ok<span class="br0">&#40;</span><span class="kw2">new</span>
  <span class="br0">&#123;</span>
     tid <span class="sy0">=</span> newEvent.<span class="me1">Id</span><span class="sy0">,</span>
<span class="xtra ln-xtra">     action <span class="sy0">=</span> resultAction </span>  <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>In the <code>PUT</code> action we need to make sure to update all properties of the model.
Additionally, we need to handle a different special case there: when a recurring series is modified, we need to delete all modified occurrences of that series:</p>

<p class='snippet'> Controllers/EventsController.cs</p>

<pre><code><pre class="js"><span class="co1">// PUT api/events/5</span>
<span class="br0">&#91;</span>HttpPut<span class="br0">&#40;</span><span class="st0">&quot;{id}&quot;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
<span class="kw2">public</span> ObjectResult Put<span class="br0">&#40;</span>int id<span class="sy0">,</span> <span class="br0">&#91;</span>FromForm<span class="br0">&#93;</span> WebApiEvent apiEvent<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw2">var</span> updatedEvent <span class="sy0">=</span> <span class="br0">&#40;</span>SchedulerEvent<span class="br0">&#41;</span>apiEvent<span class="sy0">;</span>
    <span class="kw2">var</span> dbEveht <span class="sy0">=</span> _context.<span class="me1">Events</span>.<span class="me1">Find</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span><span class="sy0">;</span>
    dbEveht.<span class="kw3">Name</span> <span class="sy0">=</span> updatedEvent.<span class="kw3">Name</span><span class="sy0">;</span>
    dbEveht.<span class="me1">StartDate</span> <span class="sy0">=</span> updatedEvent.<span class="me1">StartDate</span><span class="sy0">;</span>
    dbEveht.<span class="me1">EndDate</span> <span class="sy0">=</span> updatedEvent.<span class="me1">EndDate</span><span class="sy0">;</span>
    dbEveht.<span class="me1">EventPID</span> <span class="sy0">=</span> updatedEvent.<span class="me1">EventPID</span><span class="sy0">;</span>
    dbEveht.<span class="me1">RecType</span> <span class="sy0">=</span> updatedEvent.<span class="me1">RecType</span><span class="sy0">;</span>
    dbEveht.<span class="me1">EventLength</span> <span class="sy0">=</span> updatedEvent.<span class="me1">EventLength</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>string.<span class="me1">IsNullOrEmpty</span><span class="br0">&#40;</span>updatedEvent.<span class="me1">RecType</span><span class="br0">&#41;</span> <span class="sy0">&amp;&amp;</span> updatedEvent.<span class="me1">RecType</span> <span class="sy0">!=</span> <span class="st0">&quot;none&quot;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
     <span class="co1">//all modified occurrences must be deleted when we update a recurring series</span>
     <span class="co1">//https://docs.dhtmlx.com/scheduler/server_integration.html#recurringevents</span>
&nbsp;
        _context.<span class="me1">Events</span>.<span class="me1">RemoveRange</span><span class="br0">&#40;</span>
            _context.<span class="me1">Events</span>.<span class="me1">Where</span><span class="br0">&#40;</span>e <span class="sy0">=&gt;</span> e.<span class="me1">EventPID</span> <span class="sy0">==</span> id<span class="br0">&#41;</span>
        <span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    _context.<span class="me1">SaveChanges</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">return</span> Ok<span class="br0">&#40;</span><span class="kw2">new</span>
    <span class="br0">&#123;</span>
        action <span class="sy0">=</span> <span class="st0">&quot;updated&quot;</span>
    <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>And finally, the <code>DELETE</code> action. Here we have to check two special cases:</p>

<ul>
<li>if the event you are going to delete has a non-empty <code>event_pid</code>, it means a user deletes a modified instance of the recurring series. Instead of deleting such a record from the database, 
you need to give it <code>rec_type='none'</code>, in order for scheduler to skip this occurrence.</li>
<li>if a user deletes a whole recurring series, you also need to delete all the modified instances of that series.</li>
</ul>

<p class='snippet'> Controllers/EventsController.cs</p>

<pre><code><pre class="js"><span class="br0">&#91;</span>HttpDelete<span class="br0">&#40;</span><span class="st0">&quot;{id}&quot;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
<span class="kw2">public</span> ObjectResult DeleteEvent<span class="br0">&#40;</span>int id<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="kw2">var</span> e <span class="sy0">=</span> _context.<span class="me1">Events</span>.<span class="me1">Find</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>e <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
   <span class="co1">//some logic specific to recurring events support</span>
   <span class="co1">//https://docs.dhtmlx.com/scheduler/server_integration.html#recurringevents</span>
&nbsp;
     <span class="kw1">if</span> <span class="br0">&#40;</span>e.<span class="me1">EventPID</span> <span class="sy0">!=</span> <span class="kw2">default</span><span class="br0">&#40;</span>int<span class="br0">&#41;</span><span class="br0">&#41;</span>
     <span class="br0">&#123;</span>
        <span class="co1">// deleting a modified occurrence from a recurring series</span>
        <span class="co1">// If an event with the event_pid value was deleted, it should be updated </span>
        <span class="co1">// with rec_type==none instead of deleting.</span>
&nbsp;
        e.<span class="me1">RecType</span> <span class="sy0">=</span> <span class="st0">&quot;none&quot;</span><span class="sy0">;</span>
     <span class="br0">&#125;</span>
     <span class="kw1">else</span>
     <span class="br0">&#123;</span>
      <span class="co1">//if a recurring series deleted, delete all modified occurrences of the series</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>string.<span class="me1">IsNullOrEmpty</span><span class="br0">&#40;</span>e.<span class="me1">RecType</span><span class="br0">&#41;</span> <span class="sy0">&amp;&amp;</span> e.<span class="me1">RecType</span> <span class="sy0">!=</span> <span class="st0">&quot;none&quot;</span><span class="br0">&#41;</span>
       <span class="br0">&#123;</span>
    <span class="co1">//all modified occurrences must be deleted when we update recurring series</span>
    <span class="co1">//https://docs.dhtmlx.com/scheduler/server_integration.html#recurringevents</span>
         _context.<span class="me1">Events</span>.<span class="me1">RemoveRange</span><span class="br0">&#40;</span>
            _context.<span class="me1">Events</span>.<span class="me1">Where</span><span class="br0">&#40;</span>ev <span class="sy0">=&gt;</span> ev.<span class="me1">EventPID</span> <span class="sy0">==</span> id<span class="br0">&#41;</span>
        <span class="br0">&#41;</span><span class="sy0">;</span>
       <span class="br0">&#125;</span>
&nbsp;
        _context.<span class="me1">Events</span>.<span class="me1">Remove</span><span class="br0">&#40;</span>e<span class="br0">&#41;</span><span class="sy0">;</span>
     <span class="br0">&#125;</span>
&nbsp;
     _context.<span class="me1">SaveChanges</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="kw1">return</span> Ok<span class="br0">&#40;</span><span class="kw2">new</span>
  <span class="br0">&#123;</span>
     action <span class="sy0">=</span> <span class="st0">&quot;deleted&quot;</span>
  <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<h3>Parsing recurring series</h3>

<p>A recurring event is stored in the database as a single record that can be splitted up by Scheduler on the client side.
If you need to get dates of separate events on the server side, use a helper library for parsing recurring events of dhtmlxScheduler on ASP.NET Core.</p>

<p>You will find <a href="https://github.com/DHTMLX/scheduler-recurring-events-dotnet">the ready library on GitHub</a>.</p>

<a name='errorhandling'><h2>Error handling</h2></a>

<p>In order to handle errors, we need to declare a special <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/startup?view=aspnetcore-2.1#startup-filters">middleware class</a> 
that will capture runtime exceptions and write responses. Next it will be added to the app request pipeline. Follow the steps below:</p>

<p>1&#46; Create a middleware class from a template in the project folder.</p>

<p><img src="media/howtostart_dotnetcore_middleware.png" alt="Create middleware class" /></p>

<p>2&#46; Find the <strong>invoke</strong> method and note the <em>_next</em> call. Some handlers can throw exceptions, so let's catch them. Wrap the <em>_next</em> call with a <code>try-catch</code> block and run our handler if an error is captured.</p>

<p class='snippet'> SchedulerErrorMiddleware.cs </p>

<pre><code><pre class="js"><span class="kw2">public</span> async Task Invoke<span class="br0">&#40;</span>HttpContext httpContext<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="kw1">try</span>
    <span class="br0">&#123;</span>
       await _next<span class="br0">&#40;</span>httpContext<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span><span class="kw1">catch</span> <span class="br0">&#40;</span>Exception ex<span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        await HandleExceptionAsync<span class="br0">&#40;</span>httpContext<span class="sy0">,</span> ex<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">private</span> static Task HandleExceptionAsync<span class="br0">&#40;</span>HttpContext context<span class="sy0">,</span> Exception exception<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <span class="kw2">var</span> result <span class="sy0">=</span> JsonConvert.<span class="me1">SerializeObject</span><span class="br0">&#40;</span><span class="kw2">new</span><span class="br0">&#123;</span>
       action <span class="sy0">=</span> <span class="st0">&quot;error&quot;</span>
   <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   context.<span class="me1">Response</span>.<span class="me1">ContentType</span> <span class="sy0">=</span> <span class="st0">&quot;application/json&quot;</span><span class="sy0">;</span>
   context.<span class="me1">Response</span>.<span class="me1">StatusCode</span> <span class="sy0">=</span> StatusCodes.<span class="me1">Status500InternalServerError</span><span class="sy0">;</span>
   <span class="kw1">return</span> context.<span class="me1">Response</span>.<span class="me1">WriteAsync</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>3&#46; The middleware is ready. Now go to <strong>Startup.cs</strong> and connect the middleware in the <strong>Configure()</strong> method:</p>

<p class='snippet'> Startup.cs </p>

<pre><code><pre class="js"><span class="kw2">public</span> <span class="kw1">void</span> Configure<span class="br0">&#40;</span>IApplicationBuilder app<span class="sy0">,</span> IHostingEnvironment env<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <span class="kw1">if</span> <span class="br0">&#40;</span>env.<span class="me1">IsDevelopment</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
   <span class="br0">&#123;</span>
       app.<span class="me1">UseDeveloperExceptionPage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   <span class="br0">&#125;</span>
   <span class="kw1">else</span>
   <span class="br0">&#123;</span>
     app.<span class="me1">UseHsts</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   <span class="br0">&#125;</span>
   app.<span class="me1">UseDefaultFiles</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   app.<span class="me1">UseStaticFiles</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="xtra ln-xtra">   app.<span class="me1">UseSchedulerErrorMiddleware</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> </span>   app.<span class="me1">UseHttpsRedirection</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   app.<span class="me1">UseMvc</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>The important thing is that you add it before the <code>UseMvc</code> call.</p>

<a name='applicationsecurity'><h2>Application security</h2></a>

<p>Scheduler doesn't provide any means of preventing an application from various threats, such as SQL injections, XSS and CSRF attacks. The responsibility for keeping an application safe is on the developers
who implement the backend. Read the details in the <a class="link-hidden" href="app_security.html">corresponding article</a>.</p>

<h3>XSS protection</h3>

<p>A simple solution would be to encode the text properties of data items when we send them to the client side.</p>

<p>For example, in the below code a built-in HtmlEncoder is used to escape HTML values in the text of events. That way our database will contain unmodified data, but the client side will receive safe values of <code>event.text</code>.</p>

<p class='snippet'> Models/WebAPIEvent.cs </p>

<pre><code><pre class="js">using System.<span class="me1">Text</span>.<span class="me1">Encodings</span>.<span class="me1">Web</span><span class="sy0">;</span>
&nbsp;
<span class="kw2">public</span> static explicit operator WebAPIEvent<span class="br0">&#40;</span>SchedulerEvent ev<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="kw1">return</span> <span class="kw2">new</span> WebAPIEvent
    <span class="br0">&#123;</span>
      id <span class="sy0">=</span> ev.<span class="me1">Id</span><span class="sy0">,</span>
      text <span class="sy0">=</span> HtmlEncoder.<span class="kw2">Default</span>.<span class="me1">Encode</span><span class="br0">&#40;</span>ev.<span class="kw3">Name</span><span class="br0">&#41;</span><span class="sy0">,</span> 
      start_date <span class="sy0">=</span> ev.<span class="me1">StartDate</span>.<span class="me1">ToString</span><span class="br0">&#40;</span><span class="st0">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="br0">&#41;</span><span class="sy0">,</span>
      end_date <span class="sy0">=</span> ev.<span class="me1">EndDate</span>.<span class="me1">ToString</span><span class="br0">&#40;</span><span class="st0">&quot;yyyy-MM-dd HH:mm&quot;</span><span class="br0">&#41;</span>
    <span class="br0">&#125;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>Another approach would be to use a specialized library, e.g. <a href="https://html-agility-pack.net/">HtmlAgilityPack</a> and completely strip any HTML event when we save/load data.</p>

<a name='troubleshooting'><h2>Trouble shooting</h2></a>

<p>In case you've completed the above steps to implement Scheduler integration with ASP.NET Core, but Scheduler doesn't render events on a page, have a look at the <a class="link-" href="troubleshooting.html">Troubleshooting Backend Integration Issues</a> article. It describes 
the ways of identifying the roots of the problems.</p>

<a name='whatsnext'><h2>What's next</h2></a>

<p>Now you have a fully functioning Scheduler. You can view the full code on <a href="https://github.com/DHTMLX/scheduler-howto-dotnet-core">GitHub</a>, clone or download it and use it for your projects.</p>

<p>You can also check <a class="link-" href="guides.html">guides on the numerous features of Scheduler</a> or tutorials on <a class="link-" href="howtostart_guides.html">integration of Scheduler with other backend frameworks</a>.</p>

<!-- Content Area End -->
			<a href='howtostart_dotnet_core.html#top' class='top_link'>Back to top</a>
			<div id='disqus_thread'></div><script type='text/javascript'>var disqus_shortname = 'dhxdocumentation';var disqus_developer = 1;(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script>
		</div>
		</div>
	</div>
	<div class="footer">
		<div class='content'>
			<ul class='column'>
	<li class='group'>Base Views</li>
	<li><a href='day_view.html'>Day</a></li>
	<li><a href='week_view.html'>Week</a></li>
	<li><a href='month_view.html'>Month</a></li>
	<li><a href='year_view.html'>Year</a></li>
</ul>

<ul class='column'>
	<li class='group'>Advanced Views</li>
	<li><a href='units_view.html'>Units</a></li>
	<li><a href='timeline_view.html'>Timeline</a></li>
	<li><a href='weekagenda_view.html'>Week Agenda</a></li>
	<li><a href='grid_view.html'>Grid</a></li>
</ul>

<ul class='column'>
	<li class='group'>Customization</li>
	<li><a href='configuring_the_scheduler.html'>Scheduler</a></li>
	<li><a href='customizing_events.html'>Events</a></li>
	<li><a href='configuring_the_lightbox.html'>Lightbox</a></li>
	<li><a href='special_extensions.html'>Extensions</a></li>
</ul>

<ul class='column'>
	<li class='group'>Other Components</li>
	<li><a href='../suite/index.html'>Suite</a></li>
	<li><a href='../gantt/index.html'>Gantt</a></li>
	<li><a href='../diagram/index.html'>Diagram</a></li>
	<li><a href='http://scheduler-net.com/docs/'>Scheduler .Net</a></li>
</ul>

<ul class='column'>
	<li class='group'>API</li>
	<li><a href='api__refs__scheduler_events.html'>Events</a></li>
	<li><a href='api__refs__scheduler_methods.html'>Methods</a></li>
	<li><a href='api__refs__scheduler_props.html'>Properties</a></li>
	<li><a href='api__refs__scheduler_templates.html'>Templates</a></li>
</ul>
		</div>
	</div>
	<script src="assets/autocomplete.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		AutoComplete_init("");
		Scroll_init();
	</script>	
</body>
</html>