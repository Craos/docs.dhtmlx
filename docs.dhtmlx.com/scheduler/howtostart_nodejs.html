<!doctype html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="assets/docs-v=1599487820.css">
		<link rel="stylesheet" type="text/css" href="assets/theme-v=1599487820.css">
		<link rel="search" type="application/opensearchdescription+xml" title="Scheduler Docs" href="https://docs.dhtmlx.com/scheduler/assets/opensearch.xml">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="initial-scale = 1.0" />
		<meta name="description" content="" />
		<link href="assets/favicon.ico" rel="shortcut icon" />
		<!--[if lte IE 9]>
			<link rel="stylesheet" type="text/css" href="assets/ie.css" />
		<![endif]-->
		<!-- stub -->
		<title>dhtmlxScheduler with Node.js  Scheduler Docs</title>
	</head>
<body class="page_">
	<!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5M5RCSJ');</script><!-- End Google Tag Manager -->
	<a name="top"></a>
	
	<div class='headerBox'>
	<div class="header">
		<div class='content'>
			<a href='https://dhtmlx.com' class='top_logo'></a>
			<div class='top_menu'>
				<a href="samples/index.html">Samples</a>
				<a href="https://forum.dhtmlx.com/viewforum.php?f=6">Forum</a>
				<a href="https://dhtmlx.com/docs/technical-support.shtml">Support</a>
			</div>
			<span><a href='index.html' style="color:white">Documentation</a></span>
		</div>
	</div>
	</div>

	<div class="body">
		<div class="content">
		<div class="navigation">
			<div id="doc_navigation">
			<div class="search">
				<form method="get" action="search.php">
					<input type="text" accesskey="f" name="query" placeholder="Search the docs..." value="" autocomplete="off">
						<button type="submit"><img src="assets/common/search_icon.png"/></button>
				</form>
			</div>
			<ul><li class=""><a href="howtostart_dotnet_core.html">dhtmlxScheduler with ASP.NET Core</a></li><li class=" current"><a href="howtostart_nodejs.html">dhtmlxScheduler with Node.js</a></li><ul><li class="inner"><a href="howtostart_nodejs.html#step1initializingaproject">Step 1. Initializing a project</a></li><li class="inner"><a href="howtostart_nodejs.html#step2addingschedulertothepage">Step 2. Adding Scheduler to the page</a></li><li class="inner"><a href="howtostart_nodejs.html#step3preparingadatabase">Step 3. Preparing a database</a></li><li class="inner"><a href="howtostart_nodejs.html#step4implementingcrud">Step 4. Implementing CRUD</a></li><li class="inner"><a href="howtostart_nodejs.html#dynamicloading">Dynamic loading</a></li><li class="inner"><a href="howtostart_nodejs.html#recurringevents">Recurring events</a></li><li class="inner"><a href="howtostart_nodejs.html#applicationsecurity">Application security</a></li><li class="inner"><a href="howtostart_nodejs.html#errorhandling">Error handling</a></li><li class="inner"><a href="howtostart_nodejs.html#troubleshooting">Trouble shooting</a></li><li class="inner"><a href="howtostart_nodejs.html#whatsnext">What's next</a></li></ul><li class=""><a href="howtostart_dotnet.html">dhtmlxScheduler with ASP.NET MVC</a></li><li class=""><a href="howtostart_plain_php.html">dhtmlxScheduler with PHP</a></li><li class=""><a href="howtostart_php_laravel.html">dhtmlxScheduler with PHP:Laravel</a></li><li class=""><a href="howtostart_php_slim4.html">dhtmlxScheduler with PHP:Slim</a></li><li class=""><a href="howtostart_ruby.html">dhtmlxScheduler with Ruby on Rails</a></li><li class=""><a href="howtostart_connector.html">dhtmlxScheduler with dhtmlxConnector</a></li><li class=""><a href="howtostart_php.html">dhtmlxScheduler with PHP:Slim 3</a></li></ul>
			</div>
		</div>	  
	  
		<div class='doc' id='doc_content'>
			
			
			<div class='breadcrumb'><a class="n1" href="index.html">Start</a><a class="n2" href="guides.html">Guides</a><a class="n3" href="howtostart_guides.html">How to Start with dhtmlxScheduler</a></div>
<!-- Content Area -->



<h1>dhtmlxScheduler with Node.js</h1>

<p>The current tutorial is intended for creating Scheduler with Node.js and REST API on the server side. 
If you use some other technology, check the list of available integration variants below:</p>

<ul>
<li><a class="link-" href="howtostart_dotnet_core.html">dhtmlxScheduler with ASP.NET Core</a></li>
<li><a class="link-" href="howtostart_dotnet.html">dhtmlxScheduler with ASP.NET MVC</a></li>
<li><a class="link-" href="howtostart_plain_php.html">dhtmlxScheduler with PHP</a></li>
<li><a class="link-" href="howtostart_php_slim4.html">dhtmlxScheduler with PHP:Slim</a></li>
<li><a class="link-" href="howtostart_php_laravel.html">dhtmlxScheduler with PHP:Laravel</a></li>
<li><a class="link-" href="howtostart_ruby.html">dhtmlxScheduler with Ruby on Rails</a></li>
<li><a class="link-" href="howtostart_connector.html">dhtmlxScheduler with dhtmlxConnector</a></li>
</ul>

<p>Our implementation of Scheduler with Node.js will be based on REST API that will be used for communication with server. 
Node.js has a set of ready-made solutions, so we won't have to code everything from the very beginning.</p>

<p>This tutorial uses the <a href="http://expressjs.com/">Express</a> framework and MySQL as a data storage.</p>

<div class='note'><p><p>The complete source code is <a href="https://github.com/DHTMLX/scheduler-howto-node">available on GitHub</a>.</p>
</p></div>

<a name='step1initializingaproject'><h2>Step 1. Initializing a project</h2></a>

<h3>Creating project</h3>

<p>To begin with, create a new application using yarn:</p>

<pre><code><pre class="js">$ mkdir scheduler<span class="sy0">-</span>howto<span class="sy0">-</span>nodejs
$ cd .<span class="sy0">/</span>scheduler<span class="sy0">-</span>howto<span class="sy0">-</span>nodejs
$ yarn init</pre></code></pre>

<p>There is a set of simple questions you need to answer during initialization of a new app:</p>

<pre><code><pre class="js">$ question <span class="kw3">name</span> <span class="br0">&#40;</span>scheduler<span class="sy0">-</span>howto<span class="sy0">-</span>nodejs<span class="br0">&#41;</span><span class="sy0">:</span>
$ question version <span class="br0">&#40;</span>1.0.0<span class="br0">&#41;</span><span class="sy0">:</span>
$ question description<span class="sy0">:</span> My scheduler backend
$ question entry point <span class="br0">&#40;</span>index.<span class="me1">js</span><span class="br0">&#41;</span><span class="sy0">:</span> server.<span class="me1">js</span>
$ question repository url<span class="sy0">:</span>
$ question author<span class="sy0">:</span> Me
$ question license <span class="br0">&#40;</span>MIT<span class="br0">&#41;</span><span class="sy0">:</span> MIT
$ question <span class="kw2">private</span><span class="sy0">:</span>
$ success Saved <span class="kw2">package</span>.<span class="me1">json</span></pre></code></pre>

<p>The package manager will create a <em>package.json</em> file that will look similar to this:</p>

<pre><code><pre class="js"><span class="br0">&#123;</span>
    <span class="st0">&quot;name&quot;</span><span class="sy0">:</span> <span class="st0">&quot;scheduler-backend&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;version&quot;</span><span class="sy0">:</span> <span class="st0">&quot;1.0.0&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;main&quot;</span><span class="sy0">:</span> <span class="st0">&quot;index.js&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;author&quot;</span><span class="sy0">:</span> <span class="st0">&quot;Me&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;license&quot;</span><span class="sy0">:</span> <span class="st0">&quot;MIT&quot;</span><span class="sy0">,</span>
<span class="br0">&#125;</span></pre></code></pre>

<h3>Adding dependencies and installing modules</h3>

<p>As it was said at the beginning, the <a href="http://expressjs.com/">Express</a> framework and MySQL are used for creating the demo.</p>

<div class='note'><p><p>You should setup your MySQL server, or use some service, e.g. <a href="https://www.freemysqlhosting.net/">Free MySQL Hosting</a>.</p>
</p></div>

<p>Add express, mysql, body-parser and date-format-lite modules:</p>

<pre><code><pre class="js">$ yarn add express mysql body<span class="sy0">-</span>parser date<span class="sy0">-</span>format<span class="sy0">-</span>lite</pre></code></pre>

<p><strong>server.js</strong> has been specified as the entry point above. Now you should create this file with the code below:</p>

<p class='snippet'> server.js</p>

<pre><code><pre class="js"><span class="kw2">const</span> express <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">&quot;express&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// use Express</span>
<span class="kw2">const</span> bodyParser <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">&quot;body-parser&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// for parsing POST requests</span>
<span class="kw2">const</span> app <span class="sy0">=</span> express<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// create application</span>
<span class="kw2">const</span> port <span class="sy0">=</span> <span class="nu0">3000</span><span class="sy0">;</span> <span class="co1">// port for listening</span>
&nbsp;
<span class="co1">// It's necessary for parsing POST requests</span>
<span class="co1">// the line below is used for parsing application/x-www-form-urlencoded</span>
app.<span class="kw2">use</span><span class="br0">&#40;</span>bodyParser.<span class="me1">urlencoded</span><span class="br0">&#40;</span><span class="br0">&#123;</span>extended<span class="sy0">:</span><span class="kw2">true</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// start server</span>
app.<span class="me1">listen</span><span class="br0">&#40;</span>port<span class="sy0">,</span> <span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
    console.<span class="me1">log</span><span class="br0">&#40;</span><span class="st0">&quot;Server is running on port &quot;</span> <span class="sy0">+</span> port <span class="sy0">+</span> <span class="st0">&quot;...&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<p>Then open the <strong>package.json</strong> file, and add the "scripts" section:</p>

<pre><code><pre class="js"><span class="st0">&quot;scripts&quot;</span><span class="sy0">:</span> <span class="br0">&#123;</span>
    <span class="st0">&quot;start&quot;</span><span class="sy0">:</span> <span class="st0">&quot;node index.js&quot;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>After that <strong>package.json</strong> looks like this:</p>

<pre><code><pre class="js"><span class="br0">&#123;</span>
    <span class="st0">&quot;name&quot;</span><span class="sy0">:</span> <span class="st0">&quot;scheduler-backend&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;version&quot;</span><span class="sy0">:</span> <span class="st0">&quot;1.0.0&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;main&quot;</span><span class="sy0">:</span> <span class="st0">&quot;index.js&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;author&quot;</span><span class="sy0">:</span> <span class="st0">&quot;Me&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;license&quot;</span><span class="sy0">:</span> <span class="st0">&quot;MIT&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;scripts&quot;</span><span class="sy0">:</span> <span class="br0">&#123;</span>
        <span class="st0">&quot;start&quot;</span><span class="sy0">:</span> <span class="st0">&quot;node index.js&quot;</span>
    <span class="br0">&#125;</span><span class="sy0">,</span>
    <span class="st0">&quot;dependencies&quot;</span><span class="sy0">:</span> <span class="br0">&#123;</span>
        <span class="st0">&quot;body-parser&quot;</span><span class="sy0">:</span> <span class="st0">&quot;^1.18.3&quot;</span><span class="sy0">,</span>
        <span class="st0">&quot;date-format-lite&quot;</span><span class="sy0">:</span> <span class="st0">&quot;^17.7.0&quot;</span><span class="sy0">,</span>
        <span class="st0">&quot;express&quot;</span><span class="sy0">:</span> <span class="st0">&quot;^4.16.4&quot;</span><span class="sy0">,</span>
        <span class="st0">&quot;mysql&quot;</span><span class="sy0">:</span> <span class="st0">&quot;^2.16.0&quot;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>Now you can start the server:</p>

<pre><code><pre class="js">$ yarn start</pre></code></pre>

<p>or</p>

<pre><code><pre class="js">$ npm start</pre></code></pre>

<a name='step2addingschedulertothepage'><h2>Step 2. Adding Scheduler to the page</h2></a>

<p>Create a directory to place your front-end HTML/CSS/JS files:</p>

<pre><code><pre class="js">$ mkdir .<span class="sy0">/</span><span class="kw2">public</span></pre></code></pre>

<p>Then create an <em>index.html</em> file in the <strong>public</strong> directory:</p>

<p class='snippet'> public/index.html</p>

<pre><code><pre class="html"><span class="sc2">&lt;!doctype html&gt;</span>
<span class="sc2">&lt;<span class="kw2">html</span>&gt;</span>
    <span class="sc2">&lt;<span class="kw2">head</span>&gt;</span>
        <span class="sc2">&lt;<span class="kw2">title</span>&gt;</span>DHTMLX Sсheduler example<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">title</span>&gt;</span>
        <span class="sc2">&lt;<span class="kw2">meta</span> <span class="kw3">charset</span><span class="sy0">=</span><span class="st0">&quot;utf-8&quot;</span>&gt;</span>
        <span class="sc-1">&lt;!-- scheduler --&gt;</span>
        <span class="sc2">&lt;<span class="kw2">script</span> <span class="kw3">src</span><span class="sy0">=</span><span class="st0">&quot;https://cdn.dhtmlx.com/scheduler/edge/dhtmlxscheduler.js&quot;</span> </span>
<span class="sc2">            <span class="kw3">charset</span><span class="sy0">=</span><span class="st0">&quot;utf-8&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">script</span>&gt;</span>
      <span class="sc2">&lt;<span class="kw2">link</span> <span class="kw3">href</span><span class="sy0">=</span><span class="st0">&quot;https://cdn.dhtmlx.com/scheduler/edge/dhtmlxscheduler_material.css&quot;</span> </span>
<span class="sc2">            <span class="kw3">rel</span><span class="sy0">=</span><span class="st0">&quot;stylesheet&quot;</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text/css&quot;</span> <span class="kw3">charset</span><span class="sy0">=</span><span class="st0">&quot;utf-8&quot;</span>&gt;</span>
        <span class="sc2">&lt;<span class="kw2">style</span>&gt;</span><pre class="css">            html<span class="sy0">,</span> body<span class="br0">&#123;</span>
                <span class="kw1">margin</span><span class="sy0">:</span><span class="re3">0px</span><span class="sy0">;</span>
                <span class="kw1">padding</span><span class="sy0">:</span><span class="re3">0px</span><span class="sy0">;</span>
                <span class="kw1">height</span><span class="sy0">:</span><span class="re3">100%</span><span class="sy0">;</span>
                <span class="kw1">overflow</span><span class="sy0">:</span><span class="kw2">hidden</span><span class="sy0">;</span>
            <span class="br0">&#125;</span></pre>
        <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">style</span>&gt;</span>
    <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">head</span>&gt;</span>
    <span class="sc2">&lt;<span class="kw2">body</span>&gt;</span>
        <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;scheduler_here&quot;</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_container&quot;</span> </span>
<span class="sc2">            <span class="kw3">style</span><span class="sy0">=</span><span class="st0">'width:100%; height:100%;'</span>&gt;</span>
            <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_navline&quot;</span>&gt;</span>
                <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_prev_button&quot;</span>&gt;</span><span class="sc1">&amp;nbsp;</span><span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
                <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_next_button&quot;</span>&gt;</span><span class="sc1">&amp;nbsp;</span><span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
                <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_today_button&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
                <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_date&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
                <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_tab&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;day_tab&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
                <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_tab&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;week_tab&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
                <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_tab&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;month_tab&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
            <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
            <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_header&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
            <span class="sc2">&lt;<span class="kw2">div</span> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;dhx_cal_data&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
        <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">div</span>&gt;</span>
        <span class="sc2">&lt;<span class="kw2">script</span>&gt;</span><pre class="js">            <span class="co1">// set format of dates in the data source</span>
            scheduler.<span class="me1">config</span>.<span class="me1">xml_date</span><span class="sy0">=</span><span class="st0">&quot;%Y-%m-%d %H:%i&quot;</span><span class="sy0">;</span>
            scheduler.<span class="me1">init</span><span class="br0">&#40;</span><span class="st0">'scheduler_here'</span><span class="sy0">,</span> <span class="kw2">new</span> Date<span class="br0">&#40;</span><span class="nu0">2018</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">20</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st0">&quot;month&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
            scheduler.<span class="me1">load</span><span class="br0">&#40;</span><span class="st0">&quot;http://localhost:3000/data&quot;</span><span class="sy0">,</span> <span class="st0">&quot;json&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
            <span class="kw2">var</span> dp <span class="sy0">=</span> <span class="kw2">new</span> dataProcessor<span class="br0">&#40;</span><span class="st0">&quot;http://localhost:3000/data&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="co1">// use RESTful API on the backend</span>
            dp.<span class="me1">setTransactionMode</span><span class="br0">&#40;</span><span class="st0">&quot;REST&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            dp.<span class="me1">init</span><span class="br0">&#40;</span>scheduler<span class="br0">&#41;</span><span class="sy0">;</span></pre>        <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">script</span>&gt;</span>
    <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">body</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">html</span>&gt;</span></pre></code></pre>

<p>The above code defines a simple HTML layout, adds sources of dhtmlxScheduler from CDN and initializes scheduler using the <a class="link-" href="api__scheduler_init.html">init</a> method.
Note that 100% height is specified for the document body and for the scheduler container. Scheduler will use the size of its container, so some initial sizes are required.</p>

<h3>Setting up routes</h3>

<p>After you have added a new page, you need to make it accessible from a browser. For this tutorial, scheduler will be the default page of an app.</p>

<p>Add the code below to <strong>server.js</strong> before <code>"app.listen(...);"</code>:</p>

<p class='snippet'> server.js</p>

<pre><code><pre class="js"><span class="co1">// return static pages from the &quot;./public&quot; directory</span>
app.<span class="kw2">use</span><span class="br0">&#40;</span>express.<span class="me1">static</span><span class="br0">&#40;</span>__dirname <span class="sy0">+</span> <span class="st0">&quot;/public&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<p>Run the app again to make sure it did the trick.</p>

<p>Now when you open the URL <em>http://localhost:3000/</em> in a browser, you should see the <em>index.html</em> page.</p>

<p><img src="media/howtostart_nodejs_init.png" alt="Scheduler initialization" /></p>

<a name='step3preparingadatabase'><h2>Step 3. Preparing a database</h2></a>

<p>So, you've got an empty scheduler. Let's connect it to the database and define methods to read and write events to it.</p>

<h3>Creating a database</h3>

<p>First things first, we need a database to work with. You can create a database with your favorite mysql-client, or via the console.</p>

<p>To create a database with a mysql-client, open it and execute the code below:</p>

<pre><code><pre class="js">CREATE DATABASE  <span class="kw1">IF</span> NOT EXISTS `scheduler`<span class="sy0">;</span>
<span class="kw2">USE</span> `scheduler`<span class="sy0">;</span>
&nbsp;
DROP TABLE <span class="kw1">IF</span> EXISTS `events`<span class="sy0">;</span>
CREATE TABLE `events` <span class="br0">&#40;</span>
 `id` bigint<span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span> unsigned AUTO_INCREMENT<span class="sy0">,</span>
 `start_date` datetime NOT <span class="kw2">NULL</span><span class="sy0">,</span>
 `end_date` datetime NOT <span class="kw2">NULL</span><span class="sy0">,</span>
 `text` varchar<span class="br0">&#40;</span><span class="nu0">255</span><span class="br0">&#41;</span> <span class="kw2">DEFAULT</span> <span class="kw2">NULL</span><span class="sy0">,</span>
 PRIMARY KEY <span class="br0">&#40;</span>`id`<span class="br0">&#41;</span>
<span class="br0">&#41;</span> <span class="kw2">DEFAULT</span> CHARSET<span class="sy0">=</span>utf8<span class="sy0">;</span></pre></code></pre>

<p>To import with a mysql-console, create a <em>dump.sql</em> file with the code above. And execute command in the shell:</p>

<pre><code><pre class="js">$ mysql <span class="sy0">-</span>uuser <span class="sy0">-</span>ppass scheduler <span class="sy0">&lt;</span> dump.<span class="me1">sql</span></pre></code></pre>

<p>Let's define MySQL connection settings in a constant in <strong>server.js</strong>. They will be used later in the storage.</p>

<p class='snippet'> server.js</p>

<pre><code><pre class="js"><span class="co1">// MySQL will be used for db access and util to promisify queries</span>
<span class="kw2">const</span> util <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">&quot;util&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw2">const</span> mysql <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">'mysql'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// use your own parameters for database</span>
<span class="kw2">const</span> mysqlConfig <span class="sy0">=</span> <span class="br0">&#123;</span>
    <span class="st0">&quot;connectionLimit&quot;</span><span class="sy0">:</span> <span class="nu0">10</span><span class="sy0">,</span>
    <span class="st0">&quot;host&quot;</span><span class="sy0">:</span> <span class="st0">&quot;localhost&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;user&quot;</span><span class="sy0">:</span> <span class="st0">&quot;root&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;password&quot;</span><span class="sy0">:</span> <span class="st0">&quot;&quot;</span><span class="sy0">,</span>
    <span class="st0">&quot;database&quot;</span><span class="sy0">:</span> <span class="st0">&quot;scheduler_howto_node&quot;</span>
<span class="br0">&#125;</span><span class="sy0">;</span></pre></code></pre>

<p>When it's done, you can connect to this database from the app as follows:</p>

<p class='snippet'> server.js </p>

<pre><code><pre class="js"><span class="co1">// open connection to mysql</span>
<span class="kw2">const</span> connectionPool <span class="sy0">=</span> mysql.<span class="me1">createPool</span><span class="br0">&#40;</span>mysqlConfig<span class="br0">&#41;</span><span class="sy0">;</span>
connectionPool.<span class="me1">query</span> <span class="sy0">=</span> util.<span class="me1">promisify</span><span class="br0">&#40;</span>connectionPool.<span class="me1">query</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<p>Here <a href="https://github.com/mysqljs/mysql#pooling-connections">connection pooling</a> is used and <a href="https://nodejs.org/dist/latest-v8.x/docs/api/util.html#util_util_promisify_original">queries are wrapped into Promises</a>.
It's not strictly necessary for our app to work, but it will definitely look good later on.</p>

<p>At the next step all the database access will be put into a separate class called Storage. It'll handle database connection and all CRUD actions.</p>

<a name='step4implementingcrud'><h2>Step 4. Implementing CRUD</h2></a>

<h3>Implementing data access</h3>

<p>All the read/write logic will be defined in a separate module <code>Storage</code>. It'll take mysql connection and perform simple CRUD to the specified table: read all the events,
insert new events, update or delete the existing ones.</p>

<p>For this, create the file <em>storage.js</em> and add the code below into it:</p>

<p class='snippet'> storage.js</p>

<pre><code><pre class="js">require<span class="br0">&#40;</span><span class="st0">&quot;date-format-lite&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">// add date format</span>
&nbsp;
<span class="kw2">class</span> Storage <span class="br0">&#123;</span>
    constructor<span class="br0">&#40;</span>connection<span class="sy0">,</span> table<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">this</span>._db <span class="sy0">=</span> connection<span class="sy0">;</span>
        <span class="kw1">this</span>.<span class="me1">table</span> <span class="sy0">=</span> <span class="st0">&quot;events&quot;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co1">// get events from the table, use dynamic loading if parameters sent</span>
    async getAll<span class="br0">&#40;</span>params<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        let query <span class="sy0">=</span> <span class="st0">&quot;SELECT * FROM ??&quot;</span><span class="sy0">;</span>
        let queryParams <span class="sy0">=</span> <span class="br0">&#91;</span>
            <span class="kw1">this</span>.<span class="me1">table</span>
        <span class="br0">&#93;</span><span class="sy0">;</span>
&nbsp;
        let result <span class="sy0">=</span> await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>query<span class="sy0">,</span> queryParams<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        result.<span class="me1">forEach</span><span class="br0">&#40;</span><span class="br0">&#40;</span>entry<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
            <span class="co1">// format date and time</span>
            entry.<span class="me1">start_date</span> <span class="sy0">=</span> entry.<span class="me1">start_date</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="st0">&quot;YYYY-MM-DD hh:mm&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            entry.<span class="me1">end_date</span> <span class="sy0">=</span> entry.<span class="me1">end_date</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="st0">&quot;YYYY-MM-DD hh:mm&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">return</span> result<span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co1">// create new event</span>
    async insert<span class="br0">&#40;</span>data<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        let result <span class="sy0">=</span> await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
            <span class="st0">&quot;INSERT INTO ?? (`start_date`, `end_date`, `text`) VALUES (?,?,?)&quot;</span><span class="sy0">,</span>
            <span class="br0">&#91;</span><span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span> data.<span class="me1">start_date</span><span class="sy0">,</span> data.<span class="me1">end_date</span><span class="sy0">,</span> data.<span class="me1">text</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        <span class="kw1">return</span> <span class="br0">&#123;</span>
            action<span class="sy0">:</span> <span class="st0">&quot;inserted&quot;</span><span class="sy0">,</span>
            tid<span class="sy0">:</span> result.<span class="me1">insertId</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co1">// update event</span>
    async update<span class="br0">&#40;</span>id<span class="sy0">,</span> data<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
            <span class="st0">&quot;UPDATE ?? SET `start_date` = ?, `end_date` = ?, `text` = ? WHERE id = ?&quot;</span><span class="sy0">,</span>
            <span class="br0">&#91;</span><span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span> data.<span class="me1">start_date</span><span class="sy0">,</span> data.<span class="me1">end_date</span><span class="sy0">,</span> data.<span class="me1">text</span><span class="sy0">,</span> id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        <span class="kw1">return</span> <span class="br0">&#123;</span>
            action<span class="sy0">:</span> <span class="st0">&quot;updated&quot;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co1">// delete event</span>
    async <span class="kw1">delete</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
            <span class="st0">&quot;DELETE FROM ?? WHERE `id`=? ;&quot;</span><span class="sy0">,</span>
            <span class="br0">&#91;</span><span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span> id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        <span class="kw1">return</span> <span class="br0">&#123;</span>
            action<span class="sy0">:</span> <span class="st0">&quot;deleted&quot;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
module.<span class="me1">exports</span> <span class="sy0">=</span> Storage<span class="sy0">;</span></pre></code></pre>

<h3>Routing</h3>

<p>Then you need to set up routes, so the storage could be accessed by the scheduler you have placed on the page.</p>

<p>For this, create another helper module and call it <code>router</code>:</p>

<p class='snippet'> router.js</p>

<pre><code><pre class="js"><span class="kw2">function</span> callMethod <span class="br0">&#40;</span>method<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> async <span class="br0">&#40;</span>req<span class="sy0">,</span> res<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
        let result<span class="sy0">;</span>
&nbsp;
        <span class="kw1">try</span> <span class="br0">&#123;</span>
            result <span class="sy0">=</span> await method<span class="br0">&#40;</span>req<span class="sy0">,</span> res<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>e<span class="br0">&#41;</span> <span class="br0">&#123;</span>
            result <span class="sy0">=</span>  <span class="br0">&#123;</span>
                action<span class="sy0">:</span> <span class="st0">&quot;error&quot;</span><span class="sy0">,</span>
                message<span class="sy0">:</span> e.<span class="me1">message</span>
            <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
&nbsp;
        res.<span class="me1">send</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy0">;</span>
&nbsp;
module.<span class="me1">exports</span> <span class="sy0">=</span> <span class="br0">&#123;</span>
    setRoutes <span class="br0">&#40;</span>app<span class="sy0">,</span> prefix<span class="sy0">,</span> storage<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        app.<span class="me1">get</span><span class="br0">&#40;</span>`$<span class="br0">&#123;</span>prefix<span class="br0">&#125;</span>`<span class="sy0">,</span> callMethod<span class="br0">&#40;</span><span class="br0">&#40;</span>req<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
            <span class="kw1">return</span> storage.<span class="me1">getAll</span><span class="br0">&#40;</span>req.<span class="me1">query</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        app.<span class="me1">post</span><span class="br0">&#40;</span>`$<span class="br0">&#123;</span>prefix<span class="br0">&#125;</span>`<span class="sy0">,</span> callMethod<span class="br0">&#40;</span><span class="br0">&#40;</span>req<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
            <span class="kw1">return</span> storage.<span class="me1">insert</span><span class="br0">&#40;</span>req.<span class="me1">body</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        app.<span class="me1">put</span><span class="br0">&#40;</span>`$<span class="br0">&#123;</span>prefix<span class="br0">&#125;</span><span class="sy0">/:</span>id`<span class="sy0">,</span> callMethod<span class="br0">&#40;</span><span class="br0">&#40;</span>req<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
            <span class="kw1">return</span> storage.<span class="me1">update</span><span class="br0">&#40;</span>req.<span class="me1">params</span>.<span class="me1">id</span><span class="sy0">,</span> req.<span class="me1">body</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
        app.<span class="kw1">delete</span><span class="br0">&#40;</span>`$<span class="br0">&#123;</span>prefix<span class="br0">&#125;</span><span class="sy0">/:</span>id`<span class="sy0">,</span> callMethod<span class="br0">&#40;</span><span class="br0">&#40;</span>req<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
            <span class="kw1">return</span> storage.<span class="kw1">delete</span><span class="br0">&#40;</span>req.<span class="me1">params</span>.<span class="me1">id</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="sy0">;</span></pre></code></pre>

<p>All it does is sets up the application to listen request URLs that scheduler can send and calls the appropriate methods of the storage.</p>

<p>Note, that all methods are wrapped into <code>try-catch</code> blocks, for you to be able to capture any error and return an appropriate error response to the 
client. Check more info on <a href="server_integration.html#errorhandling">error handling</a>.</p>

<p>Also note that the exception message is written directly to the API response. It's pretty handy during the development, but in the production environment it can be a good idea 
to hide these messages from the client side, since raw mysql exceptions that get there may contain sensitive data.</p>

<h3>Getting it work together</h3>

<p>Finally, when all parts are done you can connect Storage to the application via Router:</p>

<p class='snippet'> server.js </p>

<pre><code><pre class="js"><span class="kw2">const</span> router <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">&quot;./router&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// open connection to mysql</span>
<span class="kw2">const</span> connectionPool <span class="sy0">=</span> mysql.<span class="me1">createPool</span><span class="br0">&#40;</span>mysqlConfig<span class="br0">&#41;</span><span class="sy0">;</span>
connectionPool.<span class="me1">query</span> <span class="sy0">=</span> util.<span class="me1">promisify</span><span class="br0">&#40;</span>connectionPool.<span class="me1">query</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// add listeners to basic CRUD requests</span>
<span class="kw2">const</span> Storage <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">&quot;./storage&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw2">const</span> storage <span class="sy0">=</span> <span class="kw2">new</span> Storage<span class="br0">&#40;</span>connectionPool<span class="br0">&#41;</span><span class="sy0">;</span>
router.<span class="me1">setRoutes</span><span class="br0">&#40;</span>app<span class="sy0">,</span> <span class="st0">&quot;/events&quot;</span><span class="sy0">,</span> storage<span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<p>If you restart the application now, you should be able to create delete and modify events in scheduler, all changes will be there after you reload the page.</p>

<p><img src="media/howtostart_nodejs_crud.png" alt="Scheduler CRUD" /></p>

<a name='dynamicloading'><h2>Dynamic loading</h2></a>

<p>Currently scheduler loads all records from the <em>events</em> table on startup. It can work well if you know that the amount of data will remain small over time. But when scheduler is used for 
something like a planning/booking application and you don't delete or move obsolete records to another table, the amounts of data will build up fairly quickly and in a couple of month of active usage 
you may find that your app requests a couple of MBs of events each time a user loads the page.</p>

<p>It can easily be avoided by using dynamic loading. Scheduler will add the displayed dates to the request parameters and you'll be able to return only the records that need to be displayed. 
Each time the user switches to a new data range, scheduler will request a new portion of data.</p>

<p>To enable dynamic loading in UI, you can set the <em>setLoadMode</em> option to any of the values: "day", "week", "month". For any practical reasons, "day" should work well.</p>

<p>Firstly, enable dynamic loading on the client using the <a class="link-" href="api__scheduler_setloadmode.html">setLoadMode</a> method:</p>

<p class='snippet'> public/index.html</p>

<pre><code><pre class="js">scheduler.<span class="me1">config</span>.<span class="me1">xml_date</span><span class="sy0">=</span><span class="st0">&quot;%Y-%m-%d %H:%i&quot;</span><span class="sy0">;</span>
scheduler.<span class="me1">init</span><span class="br0">&#40;</span><span class="st0">&quot;scheduler_here&quot;</span><span class="sy0">,</span> <span class="kw2">new</span> Date<span class="br0">&#40;</span><span class="nu0">2018</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">20</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="st0">&quot;week&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="xtra ln-xtra">scheduler.<span class="me1">setLoadMode</span><span class="br0">&#40;</span><span class="st0">&quot;day&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> </span>&nbsp;
<span class="co1">// load data from the backend</span>
scheduler.<span class="me1">load</span><span class="br0">&#40;</span><span class="st0">&quot;/events&quot;</span><span class="sy0">,</span> <span class="st0">&quot;json&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<p>Scheduler will sent <code>from</code> and <code>to</code> parameters in the request query, so you can add a simple <code>WHERE</code> clause in order to load only the requested range:</p>

<p class='snippet'> storage.js </p>

<pre><code><pre class="js">async getAll<span class="br0">&#40;</span>params<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    let query <span class="sy0">=</span> <span class="st0">&quot;SELECT * FROM ??&quot;</span><span class="sy0">;</span>
    let queryParams <span class="sy0">=</span> <span class="br0">&#91;</span>
        <span class="kw1">this</span>.<span class="me1">table</span>
    <span class="br0">&#93;</span><span class="sy0">;</span>
&nbsp;
<span class="xtra ln-xtra">    <span class="kw1">if</span> <span class="br0">&#40;</span>params.<span class="me1">from</span> <span class="sy0">&amp;&amp;</span> params.<span class="me1">to</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> </span>        query <span class="sy0">+=</span> <span class="st0">&quot; WHERE `end_date` &gt;= ? AND `start_date` &lt; ?&quot;</span><span class="sy0">;</span>
        queryParams.<span class="me1">push</span><span class="br0">&#40;</span>params.<span class="me1">from</span><span class="br0">&#41;</span><span class="sy0">;</span>
        queryParams.<span class="me1">push</span><span class="br0">&#40;</span>params.<span class="me1">to</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    let result <span class="sy0">=</span> await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>query<span class="sy0">,</span> queryParams<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    result.<span class="me1">forEach</span><span class="br0">&#40;</span><span class="br0">&#40;</span>entry<span class="br0">&#41;</span> <span class="sy0">=&gt;</span> <span class="br0">&#123;</span>
    <span class="co1">// format date and time</span>
        entry.<span class="me1">start_date</span> <span class="sy0">=</span> entry.<span class="me1">start_date</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="st0">&quot;YYYY-MM-DD hh:mm&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        entry.<span class="me1">end_date</span> <span class="sy0">=</span> entry.<span class="me1">end_date</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="st0">&quot;YYYY-MM-DD hh:mm&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">return</span> result<span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<a name='recurringevents'><h2>Recurring events</h2></a>

<p>In order to enable <a class="link-" href="recurring_events.html">recurring events</a> (e.g. "repeat event daily") you'll need to implement a couple of extra steps.</p>

<h3>Enabling the extension</h3>

<p>Add an appropriate extension to the scheduler page:</p>

<p class='snippet'> public/index.html</p>

<pre><code><pre class="js"><span class="sy0">&lt;!--</span> scheduler recurring tasks extension <span class="sy0">--&gt;</span>
<span class="sy0">&lt;</span>script src<span class="sy0">=</span><span class="st0">&quot;https://cdn.dhtmlx.com/scheduler/edge/ext/dhtmlxscheduler_recurring.js&quot;</span><span class="sy0">&gt;&lt;/</span>script<span class="sy0">&gt;</span></pre></code></pre>

<h3>Updating the model</h3>

<p>After that you need to update the model. It needs three additional fields:</p>

<ul>
<li>event_pid</li>
<li>event_length</li>
<li>rec_type</li>
</ul>

<p>You can add these columns to the existing events table with the following query:</p>

<pre><code><pre class="js">ALTER TABLE `events` ADD COLUMN `event_pid` bigint<span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span> unsigned <span class="kw2">DEFAULT</span> <span class="st0">'0'</span><span class="sy0">;</span>
ALTER TABLE `events` ADD COLUMN `event_length` bigint<span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span> unsigned <span class="kw2">DEFAULT</span> <span class="st0">'0'</span><span class="sy0">;</span>
ALTER TABLE `events` ADD COLUMN `rec_type` varchar<span class="br0">&#40;</span><span class="nu0">25</span><span class="br0">&#41;</span> <span class="kw2">DEFAULT</span> <span class="st0">'&quot;&quot;'</span><span class="sy0">;</span></pre></code></pre>

<p>Or create a table from scratch:</p>

<pre><code><pre class="js">CREATE TABLE `events` <span class="br0">&#40;</span>
 `id` bigint<span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span> unsigned AUTO_INCREMENT<span class="sy0">,</span>
 `start_date` datetime NOT <span class="kw2">NULL</span><span class="sy0">,</span>
 `end_date` datetime NOT <span class="kw2">NULL</span><span class="sy0">,</span>
 `text` varchar<span class="br0">&#40;</span><span class="nu0">255</span><span class="br0">&#41;</span> <span class="kw2">DEFAULT</span> <span class="kw2">NULL</span><span class="sy0">,</span>
 `event_pid` bigint<span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span> unsigned <span class="kw2">DEFAULT</span> <span class="st0">'0'</span><span class="sy0">,</span>
 `event_length` bigint<span class="br0">&#40;</span><span class="nu0">20</span><span class="br0">&#41;</span> unsigned <span class="kw2">DEFAULT</span> <span class="st0">'0'</span><span class="sy0">,</span>
 `rec_type` varchar<span class="br0">&#40;</span><span class="nu0">25</span><span class="br0">&#41;</span> <span class="kw2">DEFAULT</span> <span class="st0">'&quot;&quot;'</span><span class="sy0">,</span>
 PRIMARY KEY <span class="br0">&#40;</span>`id`<span class="br0">&#41;</span>
<span class="br0">&#41;</span> <span class="kw2">DEFAULT</span> CHARSET<span class="sy0">=</span>utf8<span class="sy0">;</span></pre></code></pre>

<h3>Updating the backend</h3>

<p>Finally, you'll need to <a class="link-" href="recurring_events.html#editingdeletingacertainoccurrenceintheseries">update the storage</a>.</p>

<p>Firstly, let's take a look at the <code>insert</code> method. Here you need to update the SQL query in order to add new columns.</p>

<p>Secondly, you should process a special case for recurring events - deletion of a specific occurrence of the recurring series requires creating a new database record and the client 
will call the <em>insert</em> action for it:</p>

<p class='snippet'> storage.js</p>

<pre><code><pre class="js"><span class="co1">// create a new event</span>
async insert<span class="br0">&#40;</span>data<span class="br0">&#41;</span> <span class="br0">&#123;</span>
   let sql <span class="sy0">=</span> <span class="st0">&quot;INSERT INTO ?? &quot;</span> <span class="sy0">+</span> 
<span class="xtra ln-xtra">      <span class="st0">&quot;(`start_date`, `end_date`, `text`, `event_pid`, `event_length`, `rec_type`) &quot;</span> <span class="sy0">+</span> </span><span class="xtra ln-xtra">      <span class="st0">&quot;VALUES (?, ?, ?, ?, ?, ?)&quot;</span><span class="sy0">;</span> </span>&nbsp;
   <span class="kw2">const</span> result <span class="sy0">=</span> await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
      sql<span class="sy0">,</span>
      <span class="br0">&#91;</span>
         <span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span>
         data.<span class="me1">start_date</span><span class="sy0">,</span>
         data.<span class="me1">end_date</span><span class="sy0">,</span>
         data.<span class="me1">text</span><span class="sy0">,</span>
         data.<span class="me1">event_pid</span> <span class="sy0">||</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="co1">//!</span>
         data.<span class="me1">event_length</span> <span class="sy0">||</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="co1">//!</span>
         data.<span class="me1">rec_type</span> <span class="co1">//!</span>
      <span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
   <span class="co1">// delete a single occurrence from a recurring series</span>
<span class="xtra ln-xtra">   let action <span class="sy0">=</span> <span class="st0">&quot;inserted&quot;</span><span class="sy0">;</span> </span><span class="xtra ln-xtra">   <span class="kw1">if</span> <span class="br0">&#40;</span>data.<span class="me1">rec_type</span> <span class="sy0">==</span> <span class="st0">&quot;none&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> </span><span class="xtra ln-xtra">     action <span class="sy0">=</span> <span class="st0">&quot;deleted&quot;</span><span class="sy0">;</span> </span><span class="xtra ln-xtra">   <span class="br0">&#125;</span> </span>&nbsp;
   <span class="kw1">return</span> <span class="br0">&#123;</span>
     action<span class="sy0">:</span> action<span class="sy0">,</span>
     tid<span class="sy0">:</span> result.<span class="me1">insertId</span>
   <span class="br0">&#125;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>The <code>update</code> action requires the same changes in the SQL query.
Additionally, we need to handle a different special case there: when a recurring series is modified, you need to delete all the modified occurrences of that series:</p>

<p class='snippet'> storage.js</p>

<pre><code><pre class="js"><span class="co1">// update an event</span>
async update<span class="br0">&#40;</span>id<span class="sy0">,</span> data<span class="br0">&#41;</span> <span class="br0">&#123;</span>
<span class="xtra ln-xtra">  <span class="kw1">if</span> <span class="br0">&#40;</span>data.<span class="me1">rec_type</span> <span class="sy0">&amp;&amp;</span> data.<span class="me1">rec_type</span> <span class="sy0">!=</span> <span class="st0">&quot;none&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> </span>      <span class="co1">//all modified occurrences must be deleted when you update a recurring series</span>
      <span class="co1">//https://docs.dhtmlx.com/scheduler/server_integration.html#recurringevents</span>
      await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
        <span class="st0">&quot;DELETE FROM ?? WHERE `event_pid`= ?;&quot;</span><span class="sy0">,</span>
        <span class="br0">&#91;</span><span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span> id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
      <span class="st0">&quot;UPDATE ?? SET &quot;</span> <span class="sy0">+</span>
      <span class="st0">&quot;`start_date` = ?, `end_date` = ?, `text` = ?, &quot;</span> <span class="sy0">+</span>
<span class="xtra ln-xtra">      <span class="st0">&quot;`event_pid` = ?, `event_length`= ?, `rec_type` = ? &quot;</span><span class="sy0">+</span> </span>      <span class="st0">&quot;WHERE id = ?&quot;</span><span class="sy0">,</span>
      <span class="br0">&#91;</span>
          <span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span>
          data.<span class="me1">start_date</span><span class="sy0">,</span>
          data.<span class="me1">end_date</span><span class="sy0">,</span>
          data.<span class="me1">text</span><span class="sy0">,</span>
<span class="xtra ln-xtra">          data.<span class="me1">event_pid</span> <span class="sy0">||</span> <span class="nu0">0</span><span class="sy0">,</span> </span><span class="xtra ln-xtra">          data.<span class="me1">event_length</span> <span class="sy0">||</span> <span class="nu0">0</span><span class="sy0">,</span> </span><span class="xtra ln-xtra">          data.<span class="me1">rec_type</span><span class="sy0">,</span> </span>          id
      <span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="kw1">return</span> <span class="br0">&#123;</span>
     action<span class="sy0">:</span> <span class="st0">&quot;updated&quot;</span>
  <span class="br0">&#125;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre></code></pre>

<p>Finally, let's update the <code>delete</code> action. Here you have to check two special cases:</p>

<ul>
<li>if the event you are going to delete has a non-empty <code>event_pid</code>, it means a user deletes a modified instance of the recurring series. Instead of deleting such a record from the database, 
you need to give it <code>rec_type='none'</code>, in order for scheduler to skip this occurrence.</li>
<li>if a user deletes a whole recurring series, you also need to delete all the modified instances of that series.</li>
</ul>

<p class='snippet'> storage.js</p>

<pre><code><pre class="js"><span class="co1">// delete an event</span>
async <span class="kw1">delete</span><span class="br0">&#40;</span>id<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="co1">// some logic specific to the recurring events support</span>
    <span class="co1">// https://docs.dhtmlx.com/scheduler/server_integration.html#recurringevents</span>
    let event <span class="sy0">=</span> await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
        <span class="st0">&quot;SELECT * FROM ?? WHERE id=? LIMIT 1;&quot;</span><span class="sy0">,</span>
        <span class="br0">&#91;</span><span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span> id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">if</span> <span class="br0">&#40;</span>event.<span class="me1">event_pid</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="co1">// deleting modified occurrence from a recurring series</span>
        <span class="co1">// If an event with the event_pid value was deleted, </span>
        <span class="co1">// it should be updated with &quot;rec_type==none&quot; instead of deleting.</span>
        event.<span class="me1">rec_type</span> <span class="sy0">=</span> <span class="st0">&quot;none&quot;</span><span class="sy0">;</span>
        <span class="kw1">return</span> await <span class="kw1">this</span>.<span class="me1">update</span><span class="br0">&#40;</span>id<span class="sy0">,</span> event<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="kw1">if</span> <span class="br0">&#40;</span>event.<span class="me1">rec_type</span> <span class="sy0">&amp;&amp;</span> event.<span class="me1">rec_type</span> <span class="sy0">!=</span> <span class="st0">&quot;none&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="co1">// if a recurring series deleted, delete all modified occurrences of the series</span>
        await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
            <span class="st0">&quot;DELETE FROM ?? WHERE `event_pid`=? ;&quot;</span><span class="sy0">,</span>
            <span class="br0">&#91;</span><span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span> id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    await <span class="kw1">this</span>._db.<span class="me1">query</span><span class="br0">&#40;</span>
        <span class="st0">&quot;DELETE FROM ?? WHERE `id`= ?;&quot;</span><span class="sy0">,</span>
        <span class="br0">&#91;</span><span class="kw1">this</span>.<span class="me1">table</span><span class="sy0">,</span> id<span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">return</span> <span class="br0">&#123;</span>
        action<span class="sy0">:</span> <span class="st0">&quot;deleted&quot;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre></code></pre>

<a name='applicationsecurity'><h2>Application security</h2></a>

<p>dhtmlxScheduler is a client-side component that doesn't have built-in security safeguards for the sake of flexibility. 
Moreover, the client side only is not able to provide reliable security measures.</p>

<p>It means that the application security is in the responsibility of a backend developer. The most obvious aspects to pay attention to are the following:</p>

<ul>
<li><p>SQL injections. All operations done in this example use parameterized SQL queries which should be safe in terms of SQL injections.</p></li>
<li><p>XSS attacks. The client side doesn't sanitize neither user input before sending it to the backend, nor server data before displaying it on a page.</p></li>
</ul>

<p>A simple measure against the latter is using the <a href="https://github.com/helmetjs/helmet"><code>helmet</code></a> module, which will add basic checks for various risks.</p>

<p>The <em>helmet</em> module can be installed as in:</p>

<pre><code><pre class="js">$ yarn install helmet</pre></code></pre>

<p>Then add the following string to <em>server.js</em> before <code>app.listen(...)</code>:</p>

<p class='snippet'> server.js</p>

<pre><code><pre class="js"><span class="kw2">const</span> helmet <span class="sy0">=</span> require<span class="br0">&#40;</span><span class="st0">&quot;helmet&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
app.<span class="kw2">use</span><span class="br0">&#40;</span>helmet<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<a name='errorhandling'><h2>Error handling</h2></a>

<p>Due to our <code>router</code> implementation, the backend API returns an <code>error</code> status in case of a captured exception.
You can process these errors on the client side using the <a href="../api__dataprocessor_onafterupdate_event.html">onAfterUpdate</a> event of the dataProcessor module:</p>

<p class='snippet'> public/index.html</p>

<pre><code><pre class="js">dp.<span class="me1">attachEvent</span><span class="br0">&#40;</span><span class="st0">&quot;onAfterUpdate&quot;</span><span class="sy0">,</span> <span class="kw2">function</span><span class="br0">&#40;</span>id<span class="sy0">,</span> action<span class="sy0">,</span> tid<span class="sy0">,</span> response<span class="br0">&#41;</span><span class="br0">&#123;</span>
   <span class="kw1">if</span> <span class="br0">&#40;</span>action <span class="sy0">==</span> <span class="st0">&quot;error&quot;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="co1">// do something here</span>
        <span class="kw3">alert</span><span class="br0">&#40;</span><span class="st0">&quot;Server error: &quot;</span> <span class="sy0">+</span> response.<span class="me1">message</span><span class="br0">&#41;</span><span class="sy0">;</span>
   <span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre></code></pre>

<a name='troubleshooting'><h2>Trouble shooting</h2></a>

<p>In case you've completed the above steps to implement Scheduler integration with Node.js, but Scheduler doesn't render events on a page, have a look at the <a class="link-" href="troubleshooting.html">Troubleshooting Backend Integration Issues</a> article. It describes 
the ways of identifying the roots of the problems.</p>

<a name='whatsnext'><h2>What's next</h2></a>

<p>Now you have a fully functioning Scheduler. You can view the full code on <a href="https://github.com/DHTMLX/scheduler-howto-node">GitHub</a>, clone or download it and use it for your projects.</p>

<p>You can also check <a class="link-" href="guides.html">guides on the numerous features of Scheduler</a> or tutorials on <a class="link-" href="howtostart_guides.html">integration of Scheduler with other backend frameworks</a>.</p>

<!-- Content Area End -->
			<a href='howtostart_nodejs.html#top' class='top_link'>Back to top</a>
			<div id='disqus_thread'></div><script type='text/javascript'>var disqus_shortname = 'dhxdocumentation';var disqus_developer = 1;(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script>
		</div>
		</div>
	</div>
	<div class="footer">
		<div class='content'>
			<ul class='column'>
	<li class='group'>Base Views</li>
	<li><a href='day_view.html'>Day</a></li>
	<li><a href='week_view.html'>Week</a></li>
	<li><a href='month_view.html'>Month</a></li>
	<li><a href='year_view.html'>Year</a></li>
</ul>

<ul class='column'>
	<li class='group'>Advanced Views</li>
	<li><a href='units_view.html'>Units</a></li>
	<li><a href='timeline_view.html'>Timeline</a></li>
	<li><a href='weekagenda_view.html'>Week Agenda</a></li>
	<li><a href='grid_view.html'>Grid</a></li>
</ul>

<ul class='column'>
	<li class='group'>Customization</li>
	<li><a href='configuring_the_scheduler.html'>Scheduler</a></li>
	<li><a href='customizing_events.html'>Events</a></li>
	<li><a href='configuring_the_lightbox.html'>Lightbox</a></li>
	<li><a href='special_extensions.html'>Extensions</a></li>
</ul>

<ul class='column'>
	<li class='group'>Other Components</li>
	<li><a href='../suite/index.html'>Suite</a></li>
	<li><a href='../gantt/index.html'>Gantt</a></li>
	<li><a href='../diagram/index.html'>Diagram</a></li>
	<li><a href='http://scheduler-net.com/docs/'>Scheduler .Net</a></li>
</ul>

<ul class='column'>
	<li class='group'>API</li>
	<li><a href='api__refs__scheduler_events.html'>Events</a></li>
	<li><a href='api__refs__scheduler_methods.html'>Methods</a></li>
	<li><a href='api__refs__scheduler_props.html'>Properties</a></li>
	<li><a href='api__refs__scheduler_templates.html'>Templates</a></li>
</ul>
		</div>
	</div>
	<script src="assets/autocomplete.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		AutoComplete_init("");
		Scroll_init();
	</script>	
</body>
</html>